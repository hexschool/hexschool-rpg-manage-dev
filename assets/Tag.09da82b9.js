import{r as n,a as r,e as W,f as A,b as e,h as V,M as X,s as K,o as N,z as G,A as f,E as Q,c as _,F as P,q as U,g as Y,p as j,D as ee,m as te,w as se,v as ae,O as oe,i as le,B as H,x as I,G as ne,P as ie}from"./index.4bfca30a.js";import{B as de}from"./tab.3aba35c3.js";import{a as Z}from"./task-tags.fb9d6aeb.js";const ce={class:"h4 text-dark mb-3 fw-bold"},re=e("p",{class:"text-danger mb-2"},"\u8ACB\u6CE8\u610F\uFF01\u522A\u9664\u5F8C\u5C07\u7121\u6CD5\u5FA9\u539F",-1),pe={class:"d-flex justify-content-end"},ue=e("button",{type:"button",class:"btn btn-primary me-2","data-bs-dismiss":"modal"}," \u53D6\u6D88 ",-1),me={__name:"TagDeleteModal",props:{name:{type:String,default:""}},emits:["delete"],setup(D,{expose:B,emit:w}){const b=D,g=n(null);return B({modalRef:g}),(x,v)=>(r(),W(X,{ref_key:"modalRef",ref:g,title:"\u662F\u5426\u522A\u9664\u6B64\u6A19\u7C64\uFF1F","has-footer":!0},{body:A(()=>[e("h5",ce,V(b.name),1),re,e("div",pe,[ue,e("button",{type:"button",class:"btn btn-danger",onClick:v[0]||(v[0]=y=>w("delete"))}," \u522A\u9664 ")])]),_:1},512))}},_e={class:"mb-3"},be=e("label",{for:"name",class:"form-label"},"\u6A19\u7C64\u540D\u7A31",-1),ve={class:"mb-3"},ye=e("label",{for:"description",class:"form-label"},"\u63CF\u8FF0",-1),fe={key:0,class:"mt-4"},ge={class:"card shadow-sm rounded-4 overflow-hidden h-100"},he=e("div",{class:"card-header bg-white py-2 d-flex align-items-center justify-content-between"},[e("h2",{class:"h6 mb-0 lh-base"},"\u5DF2\u5957\u7528\u6B64\u6A19\u7C64"),e("ul",{class:"nav nav-pills",id:"pills-tab",role:"tablist"},[e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active",id:"pills-home-tab","data-bs-toggle":"pill","data-bs-target":"#pills-home",type:"button",role:"tab","aria-controls":"pills-home","aria-selected":"true"}," \u4EFB\u52D9\u7FA4\u7D44 ")]),e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link",id:"pills-profile-tab","data-bs-toggle":"pill","data-bs-target":"#pills-profile",type:"button",role:"tab","aria-controls":"pills-profile","aria-selected":"false"}," \u4EFB\u52D9 ")])])],-1),ke={class:"card-body",style:{"max-height":"230px","overflow-y":"scroll"}},$e={class:"tab-content",id:"pills-tabContent"},we={class:"tab-pane fade show active",id:"pills-home",role:"tabpanel","aria-labelledby":"pills-home-tab",tabindex:"0"},xe={class:"list-unstyled"},Te={class:"tab-pane fade",id:"pills-profile",role:"tabpanel","aria-labelledby":"pills-profile-tab",tabindex:"0"},Me={class:"list-unstyled"},Ce=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," \u53D6\u6D88 ",-1),Ve=["disabled"],Be={__name:"TagModal",props:{type:{type:String,default:""},data:{type:Object,default:()=>({id:"",name:"",description:""})}},emits:["update"],setup(D,{expose:B,emit:w}){const b=D,{apiGetTaskTagById:g,apiPostTaskTags:x,apiPutTaskTagById:v}=Z,y=n(null),R=n(null);B({tagContentModalRef:R});const i=n("create"),T=n(""),p=n({name:"",description:""});K(()=>{var o;return(o=b.data)==null?void 0:o.id},()=>{var o;(o=b.data)!=null&&o.id?(i.value="edit",T.value=b.data.id,p.value=JSON.parse(JSON.stringify(b.data))):(i.value="create",T.value="",p.value={name:"",description:""},y.value.resetForm())});const h=n({tasksApply:[],taskGroupsApply:[]}),L=async o=>{var d,l,m,c;try{const{task_tag:u}=await g(o);h.value={tasksApply:u.tasks_apply,taskGroupsApply:u.task_groups_apply}}catch(u){w("update",{type:"\u5931\u6557",status:i.value,error:`${(l=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:l.statusCode}:${(c=(m=u==null?void 0:u.response)==null?void 0:m.data)==null?void 0:c.message}`})}};K(()=>T.value,o=>{o&&L(o)});const k=n(!1),E=async()=>{var o,d,l,m;k.value=!0;try{if(i.value==="create")await x(p.value),p.value={name:"",description:""};else{const c={name:p.value.name,description:p.value.description};await v(T.value,c)}k.value=!1,w("update",{type:"\u6210\u529F",status:i.value})}catch(c){k.value=!1,p.value.name=b.data.name,p.value.description=b.data.description,w("update",{type:"\u5931\u6557",status:i.value,error:`${(d=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:d.statusCode}: ${(m=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:m.message}`})}},F=n();return N(()=>{F.value=document.querySelectorAll("#myTab button"),F.value.forEach(o=>{const d=new de(o);o.addEventListener("click",l=>{l.preventDefault(),d.show()})})}),(o,d)=>{const l=G("Field"),m=G("ErrorMessage"),c=G("router-link"),u=G("VForm");return r(),W(u,{ref_key:"tagForm",ref:y,onSubmit:E},{default:A(({errors:S})=>[f(X,{ref_key:"tagContentModalRef",ref:R,title:i.value==="create"?"\u65B0\u589E\u6A19\u7C64":"\u7DE8\u8F2F\u6A19\u7C64","has-footer":!0},{body:A(()=>[e("div",_e,[be,f(l,{id:"name",modelValue:p.value.name,"onUpdate:modelValue":d[0]||(d[0]=t=>p.value.name=t),name:"name",label:"\u6A19\u7C64\u540D\u7A31",type:"text",class:Q(["form-control",{"is-invalid":S.name}]),rules:{required:!0}},null,8,["modelValue","class"]),f(m,{name:"name",class:"invalid-feedback"})]),e("div",ve,[ye,f(l,{as:"textarea",id:"description",modelValue:p.value.description,"onUpdate:modelValue":d[1]||(d[1]=t=>p.value.description=t),name:"description",label:"\u63CF\u8FF0",type:"text",rules:{required:!0},class:Q(["form-control",{"is-invalid":S.description}])},null,8,["modelValue","class"]),f(m,{name:"description",class:"invalid-feedback"})]),i.value==="edit"?(r(),_("div",fe,[e("div",ge,[he,e("div",ke,[e("div",$e,[e("div",we,[e("ul",xe,[(r(!0),_(P,null,U(h.value.taskGroupsApply,t=>(r(),_("li",{class:"mb-2",key:t.id},V(t.name),1))),128))])]),e("div",Te,[e("ul",Me,[(r(!0),_(P,null,U(h.value.tasksApply,t=>(r(),_("li",{class:"mb-2",key:t.id},[f(c,{target:"_blank",to:`/admin/task/list/${t.id}`},{default:A(()=>[Y(V(t.name),1)]),_:2},1032,["to"])]))),128))])])])])])])):j("",!0)]),footer:A(()=>[Ce,e("button",{type:"submit",class:"btn btn-primary",disabled:k.value},V(i.value==="create"?"\u65B0\u589E":"\u7DE8\u8F2F"),9,Ve)]),_:2},1032,["title"])]),_:1},512)}}},Re={class:"taskTag px-4 mt-4"},Fe=e("h1",{class:"fs-4 mb-3"},"\u6A19\u7C64\u7BA1\u7406",-1),Ie={class:"d-flex justify-content-between align-items-center mb-3"},Ae={class:"row w-75"},De={class:"col-md-6"},Le={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Se={class:"card-body p-0"},Ge={class:"table-responsive"},Ne={class:"table table-hover mb-0 text-nowrap",style:{"font-size":"14px"}},Pe=e("thead",{class:"bg-light"},[e("tr",null,[e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"}," \u6A19\u7C64\u540D\u7A31 "),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u63CF\u8FF0"),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u4F7F\u7528\u72C0\u614B"),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u7DE8\u8F2F")])],-1),Ue={class:"text-nowrap"},je={scope:"row",class:"ps-4"},Ee={scope:"row",class:"ps-4"},Oe={scope:"row",class:"ps-4"},qe={key:0,class:"text-success"},ze={key:1,class:"text-secondary"},Je={scope:"row",class:"ps-4"},Ke=["onClick"],Qe=e("span",{class:"material-icons align-middle fs-6"}," edit ",-1),He=["onClick"],We={key:0,class:"card-footer bg-white py-3"},Xe={class:"d-flex flex-wrap align-items-start"},tt={__name:"Tag",setup(D){const{apiGetTaskTags:B,apiDeleteTaskTagById:w}=Z,b=ee.useLoading(),g=n(!1),x=n(""),v=n(""),y=n({current_page:1,total_page:0,total:30}),R=n([]),i=async(t=1,s=10)=>{var O,q,z,J;v.value!==""?x.value=`name=${v.value}`:x.value="";const a=b.show(),{task_tags:M,pagination:$}=await B({page:t,count:s,scoped:x.value});try{R.value=M,y.value=$}catch(C){I("danger","\u53D6\u5F97\u5206\u985E\u6A19\u7C64\u5217\u8868\u5931\u6557",`${(q=(O=C==null?void 0:C.response)==null?void 0:O.data)==null?void 0:q.statusCode}:${(J=(z=C==null?void 0:C.response)==null?void 0:z.data)==null?void 0:J.message}`)}finally{a.hide()}},T=t=>{i(t)};N(async()=>{await i()});const h=te({type:"",data:{}}),L=n(null);let k=null;N(()=>{k=new H(L.value.tagContentModalRef.hModal)});const F=(t,s={})=>{h.type=t,h.data=s,k.show()},o=t=>{const s=t.status==="created"?"\u5EFA\u7ACB":"\u7DE8\u8F2F";t.type==="\u6210\u529F"?I("success",`${s}\u6A19\u7C64\u6210\u529F`,`\u5DF2\u6210\u529F${s}\u6A19\u7C64`):t.type==="\u5931\u6557"&&I("danger",`${s}\u6A19\u7C64\u5931\u6557`,t.error),k.hide(),i()},d=n(null),l=n({id:"",name:""});let m=null;N(()=>{m=new H(d.value.modalRef.hModal)});const u=(t,s)=>{l.value.id=t,l.value.name=s,m.show()},S=async()=>{var t,s,a,M;try{await w(l.value.id),I("success","\u522A\u9664\u6A19\u7C64\u6210\u529F","\u5DF2\u6210\u529F\u522A\u9664\u6A19\u7C64")}catch($){I("danger","\u522A\u9664\u6A19\u7C64\u5931\u6557",`${(s=(t=$==null?void 0:$.response)==null?void 0:t.data)==null?void 0:s.statusCode}:${(M=(a=$==null?void 0:$.response)==null?void 0:a.data)==null?void 0:M.message}`)}finally{m.hide(),l.value.id="",l.value.name="",i()}};return(t,s)=>(r(),_("div",Re,[Fe,e("div",Ie,[e("div",Ae,[e("div",De,[se(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>v.value=a),onCompositionstart:s[1]||(s[1]=a=>g.value=!0),onCompositionend:s[2]||(s[2]=a=>g.value=!1),placeholder:"\u641C\u5C0B\u4EFB\u52D9\u6A19\u7C64",class:"form-control",onKeydown:s[3]||(s[3]=oe(ne(()=>{g.value||i(1)},["prevent"]),["enter"]))},null,544),[[ae,v.value]])])]),e("button",{class:"btn btn-primary",onClick:s[4]||(s[4]=a=>F("create"))}," \u65B0\u589E\u6A19\u7C64 ")]),e("div",Le,[e("div",Se,[e("div",Ge,[e("table",Ne,[Pe,e("tbody",Ue,[(r(!0),_(P,null,U(R.value,a=>(r(),_("tr",{key:a.id,class:"align-middle"},[e("td",je,V(a.name),1),e("td",Ee,V(a.description),1),e("td",Oe,[a.is_used?(r(),_("span",qe,"\u5DF2\u4F7F\u7528")):(r(),_("span",ze,"\u672A\u4F7F\u7528"))]),e("td",Je,[e("button",{class:"btn btn-sm btn-outline-gray ms-1",onClick:M=>F("edit",a)},[Qe,Y(" \u7DE8\u8F2F ")],8,Ke),a.is_used?j("",!0):(r(),_("button",{key:0,class:"btn btn-sm btn-outline-danger ms-2",onClick:M=>u(a.id,a.name)},"\u522A\u9664",8,He))])]))),128))])])])]),y.value.total_page>1?(r(),_("div",We,[e("div",Xe,[f(le(ie),{modelValue:y.value.current_page,"onUpdate:modelValue":s[5]||(s[5]=a=>y.value.current_page=a),records:y.value.total,"per-page":10,options:{chunk:6},onPaginate:T},null,8,["modelValue","records"])])])):j("",!0)]),f(me,{ref_key:"alertRef",ref:d,onDelete:S,name:l.value.name},null,8,["name"]),f(Be,{ref_key:"tagModalRef",ref:L,type:h.type,data:h.data,onUpdate:o},null,8,["type","data"])]))}};export{tt as default};
