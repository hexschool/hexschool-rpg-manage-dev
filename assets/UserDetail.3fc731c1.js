import{t as Y,r as h,o as B,a,e as ee,f as F,b as e,g as E,h as m,i as A,M as se,B as te,j as _e,w as Z,v as ae,_ as q,c as o,k as ve,l as G,m as N,n as le,p as R,F as U,q as T,d as S,s as he,x as C,y as oe,L as be,z as j,A as M,C as X,u as fe,D as pe,E as H,G as ge}from"./index.4bfca30a.js";import{b as ye}from"./bsTab.1839eed6.js";import"./tab.3aba35c3.js";const ke=["disabled"],we=["disabled"],$e={__name:"ResetPasswordModal",props:{body:{type:Object,default(){return{nickname:String,type:String,userId:String}}}},setup(v,{expose:i}){const t=Y(v,"body"),c=h(null),w=h(null),n=h(!1);B(()=>{w.value=new te(c.value.hModal),c.value.hModal.addEventListener("hidden.bs.modal",()=>{n.value=!1})});const p=()=>{n.value=!0},$=()=>{w.value.show()},_=()=>{w.value.hide()};return i({openModal:$,hideModal:_}),(g,u)=>(a(),ee(se,{ref_key:"resetPasswordModalRef",ref:c,id:"resetPasswordModal","has-footer":!0,title:"\u91CD\u8A2D\u5BC6\u78BC\u4FE1"},{body:F(()=>[e("p",null,[E("\u78BA\u5B9A\u8981\u91CD\u65B0\u767C\u9001\u9A57\u8B49\u4FE1\u7D66 "),e("b",null,m(A(t).nickname),1),E(" \u9019\u500B\u4F7F\u7528\u8005\u55CE\uFF1F")])]),footer:F(()=>[e("button",{type:"button",class:"btn btn-primary",disabled:n.value,onClick:_}," \u53D6\u6D88 ",8,ke),e("button",{type:"button",class:"btn btn-danger",disabled:n.value,onClick:u[0]||(u[0]=y=>{g.$emit("confirm",{type:A(t).type,userId:A(t).userId,nickname:A(t).nickname}),p()})}," \u767C\u9001\u91CD\u8A2D\u5BC6\u78BC\u4FE1 ",8,we)]),_:1},512))}},xe={class:"mb-0"},Le={for:"email"},Me={class:"text-danger"},Re=["disabled"],De={__name:"DangerActionsModal",props:{body:{type:Object,default(){return{userId:String,name:String,email:String,type:String,platformType:String}}}},emits:["danger-user-method"],setup(v,{expose:i,emit:L}){const c=Y(v,"body"),w=h(null),n=h(null),d=h("");B(()=>{w.value=new te(n.value.hModal),n.value.hModal.addEventListener("hidden.bs.modal",()=>{d.value=""})});const p=_e(()=>{const{type:u}=c.value;return u==="verified"?{title:"\u662F\u5426\u767C\u9001\u9A57\u8B49\u4FE1\u4EF6\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u4EE5\u91CD\u65B0\u767C\u9001\u9A57\u8B49\u4FE1\u4EF6",description:"\u8ACB\u6CE8\u610F\uFF01\u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B\u5F8C\uFF0C\u4F7F\u7528\u8005\u9700\u91CD\u65B0\u6536\u9A57\u8B49\u4FE1\u624D\u53EF\u518D\u6B21\u767B\u5165",btn:"\u91CD\u767C\u9A57\u8B49\u4FE1"}}:u==="unverified"?{title:"\u662F\u5426\u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u5C07\u4F7F\u7528\u8005\u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B",description:"\u8ACB\u6CE8\u610F\uFF01\u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B\u5F8C\uFF0C\u4F7F\u7528\u8005\u9700\u91CD\u65B0\u6536\u9A57\u8B49\u4FE1\u624D\u53EF\u518D\u6B21\u767B\u5165",btn:"\u8F49\u70BA\u672A\u9A57\u8B49"}}:u==="deactivated"?{title:"\u662F\u5426\u505C\u6B0A\u6B64\u4F7F\u7528\u8005\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u4EE5\u505C\u6B0A\u4F7F\u7528\u8005",description:"\u8ACB\u6CE8\u610F\uFF01\u505C\u6B0A\u5F8C\u4F7F\u7528\u8005\u5C07\u7121\u6CD5\u767B\u5165\u76F4\u81F3\u6062\u5FA9\u6B0A\u9650",btn:"\u505C\u6B0A\u4F7F\u7528\u8005"}}:u==="restore"?{title:"\u662F\u5426\u6062\u5FA9\u4F7F\u7528\u8005\u6B0A\u9650\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u4EE5\u89E3\u9664\u505C\u6B0A\u4F7F\u7528\u8005",description:"\u8ACB\u6CE8\u610F\uFF01\u6062\u5FA9\u5F8C\u4F7F\u7528\u8005\u5C07\u53EF\u4EE5\u6B63\u5E38\u767B\u5165",btn:"\u89E3\u9664\u505C\u6B0A"}}:u==="deleteAccount"?{title:"\u662F\u5426\u522A\u9664\u6B64\u4F7F\u7528\u8005\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u4EE5\u522A\u9664\u4F7F\u7528\u8005",description:"\u8ACB\u6CE8\u610F\uFF01\u522A\u9664\u5F8C\u5C07\u7121\u6CD5\u5FA9\u539F",btn:"\u522A\u9664\u4F7F\u7528\u8005"}}:u==="unbindThirdParty"?{title:"\u662F\u5426\u89E3\u9664\u4EE5\u4E0B\u7D81\u5B9A\u7684\u5E33\u6236\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u7D81\u5B9A Email \u4EE5\u89E3\u9664\u7D81\u5B9A",description:"\u8ACB\u6CE8\u610F\uFF01\u89E3\u9664\u5F8C\u9700\u91CD\u65B0\u7D81\u5B9A",btn:"\u89E3\u9664\u7D81\u5B9A"}}:{body:{}}}),$=()=>{w.value.show()},_=()=>{w.value.hide()},g=()=>{const{type:u,userId:y,platformType:x}=c.value;L("danger-user-method",{userId:y,type:u,platformType:x})};return i({openModal:$,hideModal:_}),(u,y)=>(a(),ee(se,{id:"userDangerActions",ref_key:"myModal",ref:n,"has-footer":!0,title:A(p).title},{body:F(()=>[e("p",xe,m(A(c).name),1),e("p",null,m(A(c).email),1),e("label",Le,m(A(p).body.label),1),Z(e("input",{id:"email","onUpdate:modelValue":y[0]||(y[0]=x=>d.value=x),type:"email",class:"form-control",placeholder:"example@gmail.com"},null,512),[[ae,d.value]]),e("p",Me,m(A(p).body.description),1)]),footer:F(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:_},"\u53D6\u6D88"),e("button",{disabled:d.value!==A(c).email,type:"button",class:"btn btn-danger",onClick:g},m(A(p).body.btn),9,Re)]),_:1},8,["title"]))}},Ce={},Pe={class:"row"},Ue=ve('<h4 class="mt-4 mb-3">\u4ED8\u6B3E\u7D00\u9304</h4><div class="col-md-6"><div class="card shadow-sm rounded-4 overflow-hidden mb-4"><div class="card-body p-0"><div class="bg-light p-3"><table class="table"><tbody><tr><th scope="row"> \u4F7F\u7528\u8005\u540D\u7A31 </th><td></td></tr><tr><th scope="row"> Email </th><td></td></tr><tr><th scope="row"> \u4ED8\u6B3E\u7E3D\u91D1\u984D </th><td></td></tr><tr><th scope="row"> ID </th><td></td></tr></tbody></table></div><div class="p-3 table-responsive"><table class="table"><thead><tr><th scope="col"> \u5EFA\u7ACB\u6642\u9593 </th><th scope="col"> \u4ED8\u6B3E\u6642\u9593 </th><th scope="col"> \u7E3D\u91D1\u984D </th><th scope="col"> \u4E3B\u8981\u54C1\u9805 </th><th scope="col"> \u67E5\u770B\u7D30\u7BC0 </th></tr></thead><tbody><tr><th scope="row"></th><td></td><td></td><td></td><td></td></tr></tbody></table></div></div></div></div>',2),Ae=[Ue];function Ee(v,i){return a(),o("div",Pe,Ae)}const Ve=q(Ce,[["render",Ee]]),Ie={name:"UserLog",setup(){const v=G(),i=h(""),L=h(""),t=h(!1),c=N({log:[],adminLog:[],remarks:[]}),w=h(!0),n=h(!1);function d(D){n.value=!0,S.get(`/v1/user/${D}/log`).then(V=>{c.log=V.data.user_logs,t.value=!1,w.value=!1,n.value=!1})}const p=h(!0),$=h(!1);function _(D){$.value=!0,S.get(`/v1/user/${D}/admin_log`).then(V=>{c.adminLog=V.data.admin_logs,t.value=!1,p.value=!1,$.value=!1})}const g=h(!0),u=h(!1);function y(D){u.value=!0,S.get(`/v1/user/${D}/remark`).then(V=>{c.remarks=V.data.remarks,t.value=!1,g.value=!1,u.value=!1})}function x(){const{id:D}=v.params;t.value=!0,S.post(`/v1/user/${D}/remark`,{remark:L.value}).then(V=>{L.value="",V.data.message==="\u6210\u529F"&&y(D)})}return B(()=>{const{id:D}=v.params;i.value=D}),{PostAmdinRemark:x,remarkBtnDisabled:t,remarkText:L,tempID:i,remarkOverlay:g,remarkLoading:u,userLogOverlay:w,userLogLoading:n,adminLogOverlay:p,adminLogLoading:$,getUserRemark:y,getUserAdminLog:_,getUserLog:d,...le(c)}}},Te=e("h4",null,"\u7BA1\u7406\u8005\u8A3B\u8A18\u8A0A\u606F",-1),He={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Se={class:"card-body row"},ze={class:"col-md-6"},Fe={class:"d-flex align-items-end mb-3"},Oe={class:"flex-fill me-2"},je=e("label",{for:"admin_remark",class:"form-label"},"\u8A3B\u8A18\u8A0A\u606F",-1),Be=["disabled"],Ze=e("p",{class:"mb-1"}," \u8A3B\u8A18\u7D00\u9304 ",-1),Ne={class:"p-3 display-12 fw-normal mb-3 overflow-y-auto position-relative rounded-3",style:{"max-height":"200px",height:"150px","background-color":"#EDF0EF"}},qe={key:0,class:"overlay position-absolute d-flex align-items-center justify-content-center",style:{top:"0",bottom:"0",left:"0",right:"0"}},Ge={key:0,class:"spinner-border spinner-border-sm",role:"status"},We=e("span",{class:"visually-hidden"},"Loading...",-1),Je=[We],Ke={class:"text-secondary"},Qe=e("hr",null,null,-1),Xe=e("h4",null,"\u7BA1\u7406\u8005\u64CD\u4F5C",-1),Ye={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},es={class:"card-body row"},ss={class:"col-md-6"},ts=e("p",{class:"mb-2"},"\u7BA1\u7406\u64CD\u4F5C\u7D00\u9304",-1),as={class:"p-3 display-12 fw-normal mb-3 overflow-y-auto position-relative rounded-3",style:{"max-height":"200px",height:"150px","background-color":"#EDF0EF"}},ls={key:0,class:"overlay position-absolute d-flex align-items-center justify-content-center",style:{top:"0",bottom:"0",left:"0",right:"0"}},os={key:0,class:"spinner-border spinner-border-sm",role:"status"},ns=e("span",{class:"visually-hidden"},"Loading...",-1),is=[ns],ds={class:"text-secondary"},rs=e("hr",null,null,-1),cs=e("h4",null,"\u4F7F\u7528\u8005\u64CD\u4F5C",-1),us={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},ms={class:"card-body row"},_s={class:"col-md-6"},vs=e("p",{class:"mb-2"},"\u4F7F\u7528\u64CD\u4F5C\u7D00\u9304",-1),hs={class:"p-3 display-12 fw-normal mb-3 overflow-y-auto position-relative rounded-3",style:{"max-height":"200px",height:"150px","background-color":"#EDF0EF"}},bs={key:0,class:"overlay position-absolute d-flex align-items-center justify-content-center",style:{top:"0",bottom:"0",left:"0",right:"0"}},fs={key:0,class:"spinner-border spinner-border-sm",role:"status"},ps=e("span",{class:"visually-hidden"},"Loading...",-1),gs=[ps],ys={class:"text-secondary"},ks=e("hr",null,null,-1);function ws(v,i,L,t,c,w){return a(),o(U,null,[Te,e("div",He,[e("div",Se,[e("div",ze,[e("div",Fe,[e("div",Oe,[je,Z(e("input",{id:"admin_remark","onUpdate:modelValue":i[0]||(i[0]=n=>t.remarkText=n),type:"text",class:"form-control"},null,512),[[ae,t.remarkText]])]),e("button",{type:"button",class:"btn btn-primary ms-auto",disabled:t.remarkBtnDisabled,onClick:i[1]||(i[1]=n=>t.PostAmdinRemark())}," \u5132\u5B58\u8A0A\u606F ",8,Be)]),Ze,e("div",Ne,[t.remarkOverlay?(a(),o("div",qe,[e("button",{class:"btn btn-outline-dark bg-white text-dark",onClick:i[2]||(i[2]=n=>{t.getUserRemark(t.tempID)})},[E(" \u8B80\u53D6\u8A0A\u606F "),t.remarkLoading?(a(),o("div",Ge,Je)):R("",!0)])])):R("",!0),(a(!0),o(U,null,T(v.remarks,(n,d)=>(a(),o("div",{key:"admin_msg"+d,class:"mb-1"},[e("p",null,[E(m(n.nickname)+" ",1),e("span",Ke,m(new Date(n.create_time).toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"numeric"})),1)]),e("p",null,m(n.content),1),Qe]))),128))])])])]),Xe,e("div",Ye,[e("div",es,[e("div",ss,[ts,e("div",as,[t.adminLogOverlay?(a(),o("div",ls,[e("button",{class:"btn btn-outline-dark bg-white text-dark",onClick:i[3]||(i[3]=n=>{t.getUserAdminLog(t.tempID)})},[E(" \u8B80\u53D6\u8A0A\u606F "),t.adminLogLoading?(a(),o("div",os,is)):R("",!0)])])):R("",!0),(a(!0),o(U,null,T(v.adminLog,(n,d)=>(a(),o("div",{key:`user_msg${d}`,class:"mb-1"},[e("p",null,[E(m(n.nickname)+" ",1),e("span",ds,m(new Date(n.create_time).toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"numeric"})),1)]),e("p",null,m(n.content),1),rs]))),128))])])])]),cs,e("div",us,[e("div",ms,[e("div",_s,[vs,e("div",hs,[t.userLogOverlay?(a(),o("div",bs,[e("button",{class:"btn btn-outline-dark bg-white text-dark",onClick:i[4]||(i[4]=n=>{t.getUserLog(t.tempID)})},[E(" \u8B80\u53D6\u8A0A\u606F "),t.userLogLoading?(a(),o("div",fs,gs)):R("",!0)])])):R("",!0),(a(!0),o(U,null,T(v.log,(n,d)=>(a(),o("div",{key:`user_msg${d}`,class:"mb-1"},[e("p",null,[E(m(n.nickname)+" ",1),e("span",ys,m(new Date(n.create_time).toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"numeric"})),1)]),e("p",null,m(n.content),1),ks]))),128))])])])])],64)}const $s=q(Ie,[["render",ws]]),xs=e("h4",{class:"mt-4 mb-3"},"\u5DF2\u8A3B\u518A\u8AB2\u7A0B",-1),Ls={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Ms={class:"card-body"},Rs={class:"row"},Ds={class:"col-md-6"},Cs={class:"mb-3"},Ps={class:"list-unstyled"},Us={class:"text-secondary"},As={__name:"CoursesList",props:{userId:{type:String,default:""}},setup(v){const i=v,{apiGetUserCourses:L}=oe,t=h([]),c=async w=>{try{const{courses:n}=await L(w);t.value=n}catch(n){C("danger","\u53D6\u5F97\u8AB2\u7A0B\u5931\u6557",n)}};return he(()=>i.userId,w=>{c(w)}),(w,n)=>(a(),o(U,null,[xs,e("div",Ls,[e("div",Ms,[e("div",Rs,[e("div",Ds,[e("h5",Cs,"\u5171 "+m(t.value.length)+" \u9580\u8AB2\u7A0B",1),e("ul",Ps,[(a(!0),o(U,null,T(t.value,(d,p)=>(a(),o("li",{class:"d-flex justify-content-between",key:`${d.title}${p}`},[e("p",null,m(d.title),1),e("p",null,[e("span",Us,m(new Date(d.enrolled_time).toLocaleString("zh-TW",{year:"numeric",month:"numeric",day:"numeric"})),1)])]))),128))])])])])])],64))}},Es={name:"RoleAndPermissions",components:{Loading:be},setup(){const v=G(),i=h(!1),L=h(!0),t=h(""),c=N({roleList:[],rangeList:[],userHasRole:[],userHasRanges:[]});function w(){S.get("/v1/permission/roles").then(_=>{c.roleList=_.data.roles,S.get("/v1/permission/ranges").then(g=>{c.rangeList=g.data.ranges})})}function n(_){i.value=!0,c.userHasRole=[],c.userHasRanges=[],S.get(`/v1/users/${_}/permissions`).then(g=>{g.data.roles.forEach(u=>{c.userHasRole.push(u.role_id)}),g.data.ranges.forEach(u=>{u.ranges.forEach(y=>{c.userHasRanges.push(y.id)})}),i.value=!1}).catch(g=>{i.value=!1,C("danger","\u53D6\u5F97\u4F7F\u7528\u8005\u89D2\u8272\u548C\u6B0A\u9650\u5931\u6557",g)})}function d(_){const g=c.rangeList.filter(u=>u.name===_.target.id);_.target.checked?g[0].sub_ranges.forEach(u=>{c.userHasRanges.some(y=>y===u.id)||(c.userHasRanges=c.userHasRanges.concat([u.id]))}):g[0].sub_ranges.forEach(u=>{c.userHasRanges=c.userHasRanges.filter(y=>y!==u.id)})}const p=h(!1);function $(_,g){p.value=!0;const u=`/v1/users/${t.value}/permission/${_}`,y={};y[_]=g,S.put(u,y).then(x=>{x.data.message==="\u6210\u529F"?C("success",`\u7DE8\u8F2F ${_} \u6210\u529F`,`\u7DE8\u8F2F ${_} \u6210\u529F`):C("danger",`\u7DE8\u8F2F ${_} \u5931\u6557`,x.data.message),p.value=!1,n(t.value)}).catch(x=>{p.value=!1,C("danger",`\u7DE8\u8F2F ${_} \u5931\u6557`,x)})}return B(()=>{const{id:_}=v.params;w(),n(_),t.value=_}),{CheckAllRoles:d,...le(c),update:$,isLoading:i,fullPage:L,btnDisabled:p}}},Vs={class:"row"},Is=e("h4",{class:"mt-5 mb-3"},"\u500B\u4EBA\u8CC7\u8A0A",-1),Ts={class:"col-md-6"},Hs={class:"card shadow-sm rounded-4 overflow-hidden mb-4 position-relative"},Ss={class:"card-body"},zs=["id","value"],Fs=["for"],Os=e("hr",{class:"my-4"},null,-1),js=["disabled"],Bs={class:"row"},Zs=e("h4",{class:"mt-4 mb-3"},"\u55AE\u4E00\u6B0A\u9650",-1),Ns={class:"col-md-6"},qs={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Gs={class:"card-body"},Ws={class:"list-unstyled overflow-y-auto",style:{"max-height":"350px"}},Js={class:"form-check"},Ks=["id","checked"],Qs=["for"],Xs={class:"list-unstyled ms-4"},Ys=["id","value"],et=["for"],st=e("hr",null,null,-1),tt=["disabled"];function at(v,i,L,t,c,w){const n=j("loading");return a(),o(U,null,[M(n,{active:t.isLoading,"is-full-page":t.fullPage},null,8,["active","is-full-page"]),e("div",Vs,[Is,e("div",Ts,[e("div",Hs,[e("div",Ss,[(a(!0),o(U,null,T(v.roleList,d=>(a(),o("div",{key:d.id,class:"form-check form-switch"},[Z(e("input",{id:"c_"+d.id,"onUpdate:modelValue":i[0]||(i[0]=p=>v.userHasRole=p),class:"form-check-input",type:"checkbox",value:d.id},null,8,zs),[[X,v.userHasRole]]),e("label",{class:"form-check-label",for:"c_"+d.id},m(d.cht_name),9,Fs)]))),128)),Os,e("button",{type:"button",class:"btn btn-sm btn-primary",disabled:t.btnDisabled,onClick:i[1]||(i[1]=d=>t.update("roles",v.userHasRole))}," \u5132\u5B58\u8B8A\u66F4 ",8,js)])])])]),e("div",Bs,[Zs,e("div",Ns,[e("div",qs,[e("div",Gs,[e("ul",Ws,[(a(!0),o(U,null,T(v.rangeList,(d,p)=>(a(),o("li",{key:"range"+p},[e("div",Js,[e("input",{id:d.name,class:"form-check-input",type:"checkbox",checked:d.sub_ranges.every($=>v.userHasRanges.includes($.id)),onChange:i[2]||(i[2]=(...$)=>t.CheckAllRoles&&t.CheckAllRoles(...$))},null,40,Ks),e("label",{class:"form-check-label",for:d.name},m(d.cht_name),9,Qs)]),e("ul",Xs,[e("li",null,[(a(!0),o(U,null,T(d.sub_ranges,($,_)=>(a(),o("div",{key:"sub"+$.id+_,class:"form-check"},[Z(e("input",{id:"sub"+$.id,"onUpdate:modelValue":i[3]||(i[3]=g=>v.userHasRanges=g),class:"form-check-input",type:"checkbox",value:$.id},null,8,Ys),[[X,v.userHasRanges]]),e("label",{class:"form-check-label",for:"sub"+$.id},m($.cht_name),9,et)]))),128))])])]))),128))]),st,e("button",{type:"button",class:"btn btn-sm btn-primary",disabled:t.btnDisabled,onClick:i[4]||(i[4]=d=>t.update("ranges",v.userHasRanges))}," \u5132\u5B58\u8B8A\u66F4 ",8,tt)])])])])],64)}const lt=q(Es,[["render",at]]),ot={class:"about px-4 mt-4"},nt=e("p",null,[e("span",{class:"material-icons align-bottom"},"arrow_back"),E("\u8FD4\u56DE")],-1),it={key:0,class:"alert alert-danger",role:"alert"},dt=e("p",{class:"mb-0"},[e("span",{class:"material-icons align-bottom"}," info "),E(" \u6B64\u4F7F\u7528\u8005\u5DF2\u88AB\u505C\u6B0A\u3002\u82E5\u9700\u89E3\u9664\uFF0C\u8ACB\u5230\u5371\u96AA\u64CD\u4F5C\u5340\u57DF\u9032\u884C\u64CD\u4F5C ")],-1),rt=[dt],ct={class:"row position-relative align-items-start"},ut={class:"col-xl-5 col-md-8"},mt={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},_t={class:"card-body bg-white py-3 d-flex align-items-center"},vt=["src"],ht={key:1,style:{width:"60px",height:"60px"},class:"rounded-circle mx-auto bg-light mb-1"},bt={class:"ms-2"},ft={class:"mb-0"},pt={class:"mb-0"},gt={class:"col-md-12"},yt={class:"nav nav-tabs",role:"tablist"},kt=["id","aria-controls","data-bs-target","onClick"],wt={class:"tab-content",id:"myTabContent"},$t={class:"tab-pane fade show active",id:"users",role:"tabpanel","aria-labelledby":"users-tab"},xt=e("h4",{class:"mt-5 mb-3"},"\u500B\u4EBA\u8CC7\u8A0A",-1),Lt={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Mt={class:"card-body"},Rt={class:"row mb-3"},Dt={class:"col-md-6"},Ct=e("label",{for:"nickname",class:"form-label"},"\u66B1\u7A31*",-1),Pt={class:"row mb-3"},Ut={class:"col-xl-3 col-md-6"},At=e("label",{for:"last_name",class:"form-label"},"\u4F7F\u7528\u8005\u59D3\u6C0F",-1),Et={class:"col-xl-3 col-md-6"},Vt=e("label",{for:"first_name",class:"form-label"},"\u4F7F\u7528\u8005\u540D\u5B57",-1),It={class:"row mb-3"},Tt={class:"col-md-6"},Ht=e("label",{for:"email",class:"form-label"},[E("Email"),e("span",{class:"text-danger ms-2"},[e("small",null,"*\u4E0D\u5F97\u4FEE\u6539")])],-1),St=["value"],zt={class:"col-md-6"},Ft=e("label",{for:"secondary-email",class:"form-label"},"\u6B21\u8981 Email",-1),Ot=["value"],jt=e("p",{class:"mb-1"},"\u9A57\u8B49\u72C0\u614B",-1),Bt={class:"mb-3"},Zt={class:"d-inline-flex align-items-center border border-light p-1 px-2 rounded-2 bg-light"},Nt={key:0,class:"material-icons text-primary"},qt={key:1,class:"material-icons-outlined text-danger"},Gt={key:2},Wt={class:"my-0"},Jt={class:"row"},Kt={class:"col-md-6"},Qt=e("label",{for:"password",class:"form-label"},"\u91CD\u8A2D\u5BC6\u78BC",-1),Xt=e("hr",{class:"my-4"},null,-1),Yt=["disabled"],ea=e("h4",{class:"mb-3"},"\u540C\u6B65\u5E33\u865F",-1),sa={class:"col-md-6"},ta={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},aa={class:"card-body d-flex align-items-center justify-content-between"},la={class:"list-unstyled"},oa={key:0},na={key:0},ia=["onClick"],da={key:1,class:"row"},ra=e("div",{class:"col-md-6"},[e("div",{class:"card shadow-sm rounded-4 overflow-hidden mb-3"},[e("div",{class:"card-body d-flex align-items-center justify-content-between"},[e("p",{class:"mb-0"},"\u5C1A\u672A\u540C\u6B65\u4EFB\u4F55\u5E33\u865F\u3002")])])],-1),ca=[ra],ua={class:"tab-pane fade",id:"roles",role:"tabpanel","aria-labelledby":"roles-tab"},ma={class:"tab-pane fade",id:"courses",role:"tabpanel","aria-labelledby":"courses-tab"},_a={class:"tab-pane fade",id:"orders",role:"tabpanel","aria-labelledby":"orders-tab"},va={class:"tab-pane fade",id:"danger",role:"tabpanel","aria-labelledby":"danger-tab"},ha=e("h4",{class:"mt-4 mb-3"},"\u5371\u96AA\u64CD\u4F5C",-1),ba={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},fa={class:"card-body"},pa={key:0,class:"d-flex align-items-center"},ga=e("div",{class:"flex-fill"},[e("h5",null,"\u6062\u5FA9\u4F7F\u7528\u8005\u6B0A\u9650"),e("p",{class:"text-muted mb-0"},"\u6062\u5FA9\u6B64\u4F7F\u7528\u8005\u7684\u767B\u5165\u6B0A\u9650")],-1),ya={key:1,class:"d-flex align-items-center"},ka=e("div",{class:"flex-fill"},[e("h5",null,"\u505C\u6B0A\u4F7F\u7528\u8005"),e("p",{class:"text-muted mb-0"}," \u505C\u6B0A\u5F8C\u4F7F\u7528\u8005\u5C07\u7121\u6CD5\u767B\u5165\u76F4\u5230\u6062\u5FA9\u6B0A\u9650 ")],-1),wa=e("hr",null,null,-1),$a={class:"d-flex align-items-center"},xa=e("div",{class:"flex-fill"},[e("h5",null,"\u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B"),e("p",{class:"text-muted mb-0"}," \u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B\u5F8C\uFF0C\u4F7F\u7528\u8005\u9700\u91CD\u65B0\u6536\u9A57\u8B49\u4FE1\u624D\u53EF\u518D\u6B21\u767B\u5165 ")],-1),La=e("hr",null,null,-1),Ma={class:"d-flex align-items-center"},Ra=e("div",{class:"flex-fill"},[e("h5",null,"\u91CD\u767C\u9A57\u8B49\u4FE1\u4EF6"),e("p",{class:"text-muted mb-0"}," \u8F49\u70BA\u672A\u9A57\u8B49\u72C0\u614B\u5F8C\uFF0C\u4F7F\u7528\u8005\u9700\u91CD\u65B0\u6536\u9A57\u8B49\u4FE1\u624D\u53EF\u518D\u6B21\u767B\u5165 ")],-1),Da=e("hr",null,null,-1),Ca={class:"d-flex align-items-center"},Pa=e("div",{class:"flex-fill"},[e("h5",null,"\u522A\u9664\u4F7F\u7528\u8005"),e("p",{class:"text-muted mb-0"}," \u5C07\u522A\u9664\u4E00\u5207\u4F7F\u7528\u8005\u8CC7\u8A0A\uFF0C\u8ACB\u518D\u4E09\u78BA\u8A8D\uFF01 ")],-1),Ia={__name:"UserDetail",setup(v){const{apiGetUserInfo:i,apiPostUserResetPassword:L,apiDeleteUser:t,apiPutUserSuspend:c,apiPutUserSuspendRestore:w,apiPutUserInfo:n,apiPutUserUnverify:d,apiPostUserVerifyMail:p,apiDeleteUserThirdPartyPlatform:$}=oe,_=G(),g=fe(),u=pe.useLoading(),y=h(null),x=h(null),D=N([]),V=N([{id:"users-tab",name:"\u4F7F\u7528\u8005\u8CC7\u6599",target:"users",active:!0,danger:!1,element:null},{id:"roles-tab",name:"\u6B0A\u9650\u7BA1\u7406",target:"roles",active:!1,danger:!1,element:null},{id:"courses-tab",name:"\u5DF2\u8A3B\u518A\u8AB2\u7A0B",target:"courses",active:!1,danger:!1,element:null},{id:"orders-tab",name:"\u8A02\u55AE\u8CC7\u8A0A",target:"orders",active:!1,danger:!1,element:null},{id:"danger-role",name:"\u5371\u96AA\u64CD\u4F5C",target:"danger",active:!1,danger:!0,element:null}]),W={thirdparty:[]},s=h({...W}),k=h({}),J=async b=>{const l=u.show();try{const{user_info:f}=await i(b);s.value=f,s.value.first_name&&s.value.first_name!==""&&(k.value.first_name=s.value.first_name),s.value.last_name&&s.value.last_name!==""&&(k.value.last_name=s.value.last_name),k.value.nickname=s.value.nickname}catch(f){C("error",f.message)}finally{l.hide()}},K=h({type:"",nickname:"",userId:""}),ne=({type:b,nickname:l,userId:f})=>{y.value.openModal(),K.value={type:b,nickname:l,userId:f}},ie=async(b,l)=>{try{await L(b),y.value.hideModal(),C("success","\u5DF2\u5BC4\u51FA\u91CD\u8A2D\u5BC6\u78BC\u4FE1\u4EF6",`${l} \u7684\u91CD\u8A2D\u5BC6\u78BC\u4FE1\u4EF6\u5DF2\u7D93\u6210\u529F\u5BC4\u51FA\u3002`)}catch(f){y.value.hideModal(),C("danger","\u91CD\u8A2D\u5BC6\u78BC\u4FE1\u4EF6\u5BC4\u51FA\u5931\u6557",f)}},de=({type:b,userId:l,nickname:f})=>{b==="resetPassword"&&ie(l,f)},Q=h({}),z=({userId:b,type:l,name:f,email:I,platformType:O})=>{x.value.openModal(),Q.value={userId:b,type:l,name:f,email:I,platformType:O}},re=async({userId:b,platformType:l})=>{try{await $(b,l)}catch(f){C("danger","\u89E3\u9664\u7D81\u5B9A\u5931\u6557",f)}},ce=async({userId:b,type:l,platformType:f})=>{const I=u.show();try{l==="deleteAccount"?await t(b):l==="deactivated"?await c(b):l==="restore"?await w(b):l==="unverified"?await d(b):l==="verified"?await p(b):l==="unbindThirdParty"&&await re({userId:b,platformType:f}),x.value.hideModal(),C("success","\u5371\u96AA\u64CD\u4F5C\u6210\u529F\uFF0C3 \u79D2\u5F8C\u8DF3\u56DE\u4F7F\u7528\u8005\u5217\u8868",`\u4F7F\u7528\u8005\u5DF2\u7D93\u88AB ${l} \u4E86\u3002`),setTimeout(()=>{g.push("/admin/users")},3e3)}catch(O){x.value.hideModal(),C("danger","\u5371\u96AA\u64CD\u4F5C\u5931\u6557\uFF0C\u8ACB\u91CD\u65B0\u64CD\u4F5C",O)}finally{I.hide()}},ue=async b=>{const l=u.show();try{const f={nickname:k.value.nickname};k.value.password&&(f.password=k.value.password),k.value.last_name&&(f.last_name=k.value.last_name.replaceAll(/\s/g,"")),k.value.first_name&&(f.first_name=k.value.first_name.replaceAll(/\s/g,""));const{message:I}=await n(b,f);Object.assign(s,W),C("success","\u66F4\u65B0\u4F7F\u7528\u8005\u8A0A\u606F\u6210\u529F",I),J(b)}catch(f){C("danger","\u66F4\u65B0\u4F7F\u7528\u8005\u8A0A\u606F\u5931\u6557",f)}finally{l.hide(),k.value.password=""}};return B(()=>{const{id:b}=_.params;J(b),ye(D,V)}),(b,l)=>{const f=j("router-link"),I=j("Field"),O=j("ErrorMessage"),me=j("VForm");return a(),o("div",ot,[M(f,{to:"/admin/users"},{default:F(()=>[nt]),_:1}),s.value.state_name==="lock"?(a(),o("div",it,rt)):R("",!0),e("div",ct,[e("div",ut,[e("div",mt,[e("div",_t,[e("div",null,[s.value.avatar?(a(),o("img",{key:0,src:s.value.avatar,style:{width:"80px",height:"80px"},class:"rounded-circle mx-auto my-2 d-block",alt:"\u982D\u50CF"},null,8,vt)):(a(),o("div",ht))]),e("div",bt,[e("p",ft,m(s.value.nickname?s.value.nickname:`${s.value.last_name}${s.value.first_name}`),1),e("p",pt,m(s.value.email?s.value.email:"\u5C1A\u672A\u7D81\u5B9A Email"),1)])])])]),e("div",gt,[e("ul",yt,[(a(!0),o(U,null,T(V,r=>(a(),o("li",{class:"nav-item",role:"presentation",key:r.id},[e("button",{class:H(["nav-link border",{active:r.active,"text-danger bg-danger bg-opacity-10":r.danger}]),id:r.id,type:"button",role:"tab","aria-controls":r.id,"aria-selected":"true","data-bs-target":`#${r.target}`,ref_for:!0,ref:P=>D.push(P),onClick:ge(P=>r.element.show(),["prevent"])},m(r.name),11,kt)]))),128))]),e("div",wt,[e("div",$t,[xt,e("div",Lt,[e("div",Mt,[M(me,{onSubmit:l[5]||(l[5]=r=>ue(s.value.user_id))},{default:F(({errors:r})=>[e("div",Rt,[e("div",Dt,[Ct,M(I,{id:"nickname",modelValue:k.value.nickname,"onUpdate:modelValue":l[0]||(l[0]=P=>k.value.nickname=P),name:"nickname",type:"text",class:H(["form-control",{"is-invalid":r.nickname}]),rules:{required:!0,regex:/^[a-zA-Z0-9\u4e00-\u9fa5_-][a-zA-Z0-9 \u4e00-\u9fa5_-]{0,18}[a-zA-Z0-9\u4e00-\u9fa5_-]$/}},null,8,["modelValue","class"]),r.nickname?(a(),o("span",{key:0,role:"alert",class:H({"invalid-feedback":r.nickname})}," \u66B1\u7A31\u7684\u683C\u5F0F\u932F\u8AA4\u3002\u8ACB\u4F7F\u7528\u5927\u5C0F\u5BEB\u82F1\u6587\u3001\u4E2D\u6587\u5B57\uFF0C\u7B26\u865F\u50C5\u63A5\u53D7 - _ \u548C\u7A7A\u683C\uFF0C\u6700\u9577 20 \u500B\u5B57",2)):R("",!0)])]),e("div",Pt,[e("div",Ut,[At,M(I,{id:"last_name",modelValue:k.value.last_name,"onUpdate:modelValue":l[1]||(l[1]=P=>k.value.last_name=P),name:"last_name",type:"text",class:H(["form-control",{"is-invalid":r.last_name}]),rules:{required:!1,regex:k.value.last_name?/^[a-zA-Z0-9\u4e00-\u9fa5_-][a-zA-Z0-9\u4e00-\u9fa5_-]{0,11}$/:""}},null,8,["modelValue","class","rules"]),r.last_name?(a(),o("span",{key:0,role:"alert",class:H({"invalid-feedback":r.last_name})}," \u4F7F\u7528\u8005\u59D3\u6C0F\u7684\u683C\u5F0F\u932F\u8AA4\u3002\u8ACB\u4F7F\u7528\u5927\u5C0F\u5BEB\u82F1\u6587\u3001\u4E2D\u6587\u5B57\uFF0C\u4E0D\u80FD\u6709\u7A7A\u683C\uFF0C\u7B26\u865F\u50C5\u63A5\u53D7 - _\uFF0C\u6700\u9577 12 \u500B\u5B57",2)):R("",!0)]),e("div",Et,[Vt,M(I,{id:"first_name",modelValue:k.value.first_name,"onUpdate:modelValue":l[2]||(l[2]=P=>k.value.first_name=P),name:"first_name",type:"text",class:H(["form-control",{"is-invalid":r.first_name}]),rules:{required:!1,regex:k.value.first_name?/^[a-zA-Z0-9\u4e00-\u9fa5_-][a-zA-Z0-9\u4e00-\u9fa5_-]{0,11}$/:""}},null,8,["modelValue","class","rules"]),r.first_name?(a(),o("span",{key:0,role:"alert",class:H({"invalid-feedback":r.first_name})}," \u4F7F\u7528\u8005\u540D\u5B57\u7684\u683C\u5F0F\u932F\u8AA4\u3002\u8ACB\u4F7F\u7528\u5927\u5C0F\u5BEB\u82F1\u6587\u3001\u4E2D\u6587\u5B57\uFF0C\u4E0D\u80FD\u6709\u7A7A\u683C\uFF0C\u7B26\u865F\u50C5\u63A5\u53D7 - _\uFF0C\u6700\u9577 12 \u500B\u5B57",2)):R("",!0)])]),e("div",It,[e("div",Tt,[Ht,e("input",{id:"email",type:"text",class:"form-control",value:s.value.email,disabled:""},null,8,St)]),e("div",zt,[Ft,e("input",{id:"secondary-email",type:"text",class:"form-control",value:s.value.secondary_email,disabled:""},null,8,Ot)])]),e("div",null,[jt,e("div",Bt,[e("div",Zt,[s.value.state_name==="verified"?(a(),o("span",Nt,"check_circle")):s.value.state_name==="lock"?(a(),o("span",qt,"remove_circle")):(a(),o("span",Gt)),e("p",Wt,m(s.value.state_cht_name),1)])])]),e("div",Jt,[e("div",Kt,[Qt,M(I,{id:"password",modelValue:k.value.password,"onUpdate:modelValue":l[3]||(l[3]=P=>k.value.password=P),name:"password",type:"password",class:H(["form-control",{"is-invalid":r.password}]),rules:{regex:k.value.password?/^.*(?=.{8,})(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*$/:""}},null,8,["modelValue","class","rules"]),M(O,{name:"password",class:"invalid-feedback"}),e("button",{type:"button",class:"btn btn-sm btn-outline-dark mt-2",onClick:l[4]||(l[4]=P=>ne({type:"resetPassword",nickname:s.value.nickname,userId:s.value.user_id}))}," \u767C\u9001\u91CD\u8A2D\u5BC6\u78BC\u4FE1 ")])]),Xt,e("button",{type:"submit",class:"btn btn-primary",disabled:Object.keys(r).length>0}," \u5132\u5B58 ",8,Yt)]),_:1})])]),ea,s.value.thirdparty.length?(a(!0),o(U,{key:0},T(s.value.thirdparty,r=>(a(),o("div",{class:"row",key:r.id},[e("div",sa,[e("div",ta,[e("div",aa,[e("div",null,[e("h5",null,m(r.platform),1),e("ul",la,[e("li",null,"ID\uFF1A"+m(r.id),1),r.email?(a(),o("li",oa,"Email\uFF1A"+m(r.email),1)):R("",!0),e("li",null,"\u66B1\u7A31\uFF1A"+m(r.nickname),1)])]),r.platform==="teachable"?(a(),o("div",na,[e("button",{type:"button",class:"btn btn-primary",onClick:P=>z({userId:s.value.user_id,type:"unbindThirdParty",name:s.value.nickname,email:s.value.email,platformType:r.platform})}," \u89E3\u9664\u7D81\u5B9A ",8,ia)])):R("",!0)])])])]))),128)):(a(),o("div",da,ca)),M($s)]),e("div",ua,[M(lt)]),e("div",ma,[M(As,{"user-id":s.value.user_id},null,8,["user-id"])]),e("div",_a,[M(Ve)]),e("div",va,[ha,e("div",ba,[e("div",fa,[s.value.state_name==="lock"?(a(),o("div",pa,[ga,e("button",{type:"button",class:"btn btn-outline-dark",onClick:l[6]||(l[6]=r=>z({userId:s.value.user_id,type:"restore",name:s.value.nickname,email:s.value.email}))}," \u89E3\u9664\u505C\u6B0A ")])):R("",!0),s.value.state_name!=="lock"?(a(),o("div",ya,[ka,e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:l[7]||(l[7]=r=>z({userId:s.value.user_id,type:"deactivated",name:s.value.nickname,email:s.value.email}))}," \u505C\u6B0A\u4F7F\u7528\u8005 ")])])):R("",!0),wa,e("div",$a,[xa,e("div",null,[e("button",{onClick:l[8]||(l[8]=r=>z({userId:s.value.user_id,type:"unverified",name:s.value.nickname,email:s.value.email})),type:"button",class:"btn btn-primary"}," \u8F49\u70BA\u672A\u9A57\u8B49 ")])]),La,e("div",Ma,[Ra,e("div",null,[e("button",{type:"button",class:"btn btn-primary",onClick:l[9]||(l[9]=r=>z({userId:s.value.user_id,type:"verified",name:s.value.nickname,email:s.value.email}))}," \u91CD\u767C\u9A57\u8B49\u4FE1 ")])]),Da,e("div",Ca,[Pa,e("div",null,[e("button",{type:"button",class:"btn btn-danger",onClick:l[10]||(l[10]=r=>z({userId:s.value.user_id,type:"deleteAccount",name:s.value.nickname,email:s.value.email}))}," \u522A\u9664\u4F7F\u7528\u8005 ")])])])])])])])]),M($e,{ref_key:"resetPasswordRef",ref:y,body:K.value,onConfirm:de},null,8,["body"]),M(De,{ref_key:"dangerActionsModalRef",ref:x,body:Q.value,onDangerUserMethod:ce},null,8,["body"])])}}};export{Ia as default};
