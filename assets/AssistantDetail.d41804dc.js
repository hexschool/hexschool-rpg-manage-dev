import{l as ps,D as bs,r as n,s as H,m as J,o as ms,z as K,a as d,c,b as s,A as Q,f as gs,h as v,g as P,F as b,q as m,w as G,C as D,p as ks,x as g,E as fs,G as ys,$ as ws}from"./index.4bfca30a.js";/* empty css                   */import{b as Ls}from"./bsTab.1839eed6.js";import{a as xs}from"./assistant.68cb06e3.js";import{a as Ts}from"./task.af703141.js";import"./tab.3aba35c3.js";const Cs={class:"about px-4 mt-4"},As={class:"border-bottom border-light pb-2 mb-4"},$s={"aria-label":"breadcrumb"},Gs={class:"breadcrumb"},Ds={class:"breadcrumb-item"},Vs=s("li",{class:"breadcrumb-item active","aria-current":"page"},"\u7DE8\u8F2F\u52A9\u6559",-1),Es=s("h1",{class:"fs-4 mb-0"},"\u7DE8\u8F2F\u52A9\u6559",-1),Ss={id:"assistantDetail",class:"col-md-5"},Ns={class:"assistant card shadow-sm rounded-4 overflow-hidden mb-4"},Us={class:"card-header bg-white py-3"},Ms=s("div",{style:{width:"60px",height:"60px"},class:"rounded-circle mx-auto bg-light mb-1"},null,-1),Ps={class:"text-center mb-0"},zs={class:"card-body"},Bs={class:"d-flex align-items-center"},js=s("span",{class:"material-icons-outlined me-1"},"email",-1),Fs={class:"d-flex"},Is=s("span",{class:"material-icons-outlined me-1"},"face",-1),Rs={class:"col-md-12"},qs={class:"nav nav-tabs",role:"tablist"},Os=["id","aria-controls","data-bs-target","onClick"],Hs={class:"tab-content mb-5",id:"myTabContent"},Js={class:"tab-pane fade show active",id:"assistantTab",role:"tabpanel","aria-labelledby":"assistant-tab"},Ks={class:"mt-4 card shadow-sm rounded-4 overflow-hidden mb-4"},Qs=s("div",{class:"card-header bg-white py-3"},[s("h2",{class:"fs-6 mb-0 lh-base"},"\u52A9\u6559\u7A31\u865F")],-1),Ws={class:"card-body card-body-height"},Xs={class:"list list-unstyled"},Ys={class:"form-check"},Zs=["id","value","checked"],se=["for"],ee=s("hr",null,null,-1),te={class:"card-footer bg-white text-end py-3"},ae={class:"tab-pane fade",id:"coursesTab",role:"tabpanel","aria-labelledby":"courses-tab"},oe={class:"mt-4 row position-relative align-items-start"},le={class:"col-md-4 users-sticky-md-top",style:{top:"80px"}},ie={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},ne=s("div",{class:"card-header bg-white py-3"},[s("h2",{class:"fs-6 mb-0 lh-base"},"\u53EF\u6279\u6539\u7684\u4F5C\u696D\u5217\u8868")],-1),de={class:"card-body card-body-height"},ce={class:"list list-unstyled"},re=s("hr",null,null,-1),ue={class:"col-md-8"},he={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},_e={class:"card-header bg-white py-3"},ve={class:"form-check"},pe=s("label",{class:"h2 fs-6 mb-0 lh-base",for:"assistantAll"},"\u6279\u6539\u8AB2\u7A0B\u8A2D\u5B9A",-1),be={class:"card-body card-body-height"},me={class:"list list-unstyled"},ge={class:"form-check"},ke=["id","value","checked"],fe=["for"],ye=s("hr",null,null,-1),we={class:"card-footer bg-white text-end py-3"},Le={class:"tab-pane fade",id:"tasksTab",role:"tabpanel","aria-labelledby":"tasks-tab"},xe={class:"mt-4 row position-relative align-items-start"},Te={class:"col-md-4 users-sticky-md-top",style:{top:"80px"}},Ce={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Ae=s("div",{class:"card-header bg-white py-3"},[s("h2",{class:"fs-6 mb-0 lh-base"},"\u53EF\u6279\u6539\u7684\u4EFB\u52D9\u5217\u8868")],-1),$e={class:"card-body card-body-height"},Ge={id:"task-group",class:"list-unstyled mb-0"},De=["aria-controls","href"],Ve={class:"fw-bold"},Ee=["id"],Se={class:"list list-unstyled"},Ne={class:"col-md-8"},Ue={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Me=s("div",{class:"card-header bg-white py-3 fw-bold"}," \u6279\u6539\u4EFB\u52D9\u8A2D\u5B9A ",-1),Pe={class:"card-body card-body-height"},ze={key:0,class:"form-check"},Be=s("label",{class:"h2 fs-6 mb-0 lh-base",for:"tasksAll"},"\u5168\u9078",-1),je={id:"task-list",class:"list list-unstyled mt-3"},Fe={class:"form-check"},Ie=["id","value"],Re=["for"],qe=s("hr",null,null,-1),Oe={class:"card-footer bg-white text-end py-3"},st={__name:"AssistantDetail",setup(He){const{apiGetVideoCoursesList:W,apiGetAssistantDetail:X,apiPutAssistantDetail:Y,apiGetAssistantsTitles:Z,apiPutAssistantTasks:ss,apiDeleteAssistantTasks:es}=xs,{apiGetTaskGroupsList:ts,apiGetTasks:as}=Ts,os=ps(),k=bs.useLoading(),S=(a,t,o)=>a.map(r=>(r[t]=o,r)),y=n([]),h=n([]),_=n([]),w=n(!1),ls=()=>{w.value?(_.value=[],y.value.forEach(a=>{_.value.push(a.id)})):_.value=[]};H(()=>_.value,()=>{y.value.length!==0&&_.value.length===y.value.length?w.value=!0:w.value=!1},{deep:!0});const is=()=>{y.value.forEach(a=>{h.value.video_courses.forEach(t=>{a.id===t.id&&(a.isChecked=!0,_.value.push(a.id))})})},ns=async()=>{const a=k.show();try{_.value=[];const{courses:t}=await W();y.value=S(t,"isChecked",!1),is()}catch(t){g("danger","\u53D6\u5F97\u8AB2\u7A0B\u5217\u8868\u5931\u6557",`${t.response.data.statusCode}:${t.response.data.message}`)}finally{a.hide()}},N=n([]),L=n([]),ds=()=>{N.value.forEach(a=>{h.value.assistant_titles.forEach(t=>{a.id===t.id&&(a.isChecked=!0,L.value.push(a.id))})})},cs=async()=>{const a=k.show();try{L.value=[];const{assistant_titles:t}=await Z();N.value=S(t,"isChecked",!1),ds()}catch(t){g("danger","\u53D6\u5F97\u52A9\u6559\u7A31\u865F\u5931\u6557",`${t.response.data.statusCode}:${t.response.data.message}`)}finally{a.hide()}},p=n(""),U=n([]),x=n({taskGroupsList:[],pagination:{total:100,count:10,total_page:10,current_page:1}}),V=n(1),rs=async(a=1)=>{var o,r,e,i;const t=k.show();try{const{task_groups:l,pagination:f}=await ts({count:150,page:a});x.value.taskGroupsList=l,x.value.pagination=f,V.value=f.current_page,U.value=[...U.value,...x.value.taskGroupsList]}catch(l){g("danger","\u53D6\u5F97\u4EFB\u52D9\u7FA4\u7D44\u5217\u8868\u5931\u6557",`${(r=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:r.statusCode} : ${(i=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:i.message}`)}finally{t.hide()}},z=async(a=1)=>{await rs(a),x.value.pagination.total_page!==0&&V.value!==x.value.pagination.total_page&&(V.value+=1,z(V.value))},T=n([]),C=n({tasksList:[],pagination:{total:100,count:10,total_page:10,current_page:1}}),E=n(1),B=n(null),us=async(a=1)=>{var o,r,e,i;const t=k.show();try{const{tasks:l,pagination:f}=await as({count:100,page:a,scoped:B.value});C.value.tasksList=S(l,"isChecked",!1),C.value.tasksList=l,C.value.pagination=f,E.value=f.current_page,T.value=[...T.value,...l]}catch(l){g("danger","\u53D6\u5F97\u6307\u5B9A\u7684\u4EFB\u52D9\u7FA4\u7D44\u4EFB\u52D9\u5217\u8868\u5931\u6557",`${(r=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:r.statusCode} : ${(i=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:i.message}`)}finally{t.hide()}},j=n(""),u=n([]),M=async a=>{var o,r;const t=k.show();try{const e=await X(a);h.value=e,u.value=[],e.task_groups.forEach(i=>{i.tasks&&i.tasks.forEach(l=>{u.value.push({id:l.id,task_group_id:i.id})})}),ns(),cs()}catch(e){g("danger","\u53D6\u5F97\u52A9\u6559\u8CC7\u8A0A\u5931\u6557",`${(o=e.response)==null?void 0:o.data.statusCode}:${(r=e.response)==null?void 0:r.data.message}`)}finally{t.hide()}},F=async(a=1)=>{await us(a),C.value.pagination.total_page!==0&&E.value!==C.value.pagination.total_page&&(E.value+=1,F(E.value))},hs=async a=>{j.value=a,B.value=`&filter=task_group&task_group_id=${j.value}`,T.value=[],await F()},I=async a=>{const t=k.show();try{const o={video_course_list:_.value,assistant_title_list:L.value};await Y(a,o),g("success","\u66F4\u65B0\u6210\u529F","\u5DF2\u6210\u529F\u7DE8\u8F2F\u52A9\u6559\u8A2D\u5B9A"),M(a)}catch(o){g("danger","\u66F4\u65B0\u52A9\u6559\u8CC7\u8A0A\u5931\u6557",`${o.response.data.statusCode}:${o.response.data.message}`)}finally{t.hide()}},A=n([]),$=n(!1),R=()=>{var a;if(A.value=T.value.map(t=>({id:t.id,task_group_id:p.value})),$.value)u.value.length===0&&u.value.push(...A.value),A.value.forEach(t=>{u.value.findIndex(r=>r.id===t.id)===-1&&u.value.push(t)});else{const t=A.value.map(o=>o.id);u.value=(a=u.value)==null?void 0:a.filter(o=>{if(!t.includes(o.id))return o}),A.value=[]}},_s=()=>{u.value.some(t=>p.value===t.task_group_id)?($.value=!0,R()):$.value=!1},vs=async a=>{const t=k.show();try{let o=[];u.value.length>0?(o=u.value.reduce((e,i)=>{let l=e.find(f=>f.task_group_id===i.task_group_id);return l||(l={id:i.task_group_id,task_ids:[]},e.push(l)),l.task_ids.push(i.id),e},[]),await ss(a,{task_groups:o})):await es(a),M(a)}catch(o){g("danger","\u66F4\u65B0\u52A9\u6559\u53EF\u6279\u6539\u4EFB\u52D9\u8A2D\u5B9A\u5931\u6557",`${o.response.data.statusCode}:${o.response.data.message}`)}finally{t.hide()}},q=J([]),O=J([{id:"assistant-tab",name:"\u52A9\u6559\u7A31\u865F\u8A2D\u5B9A",target:"assistantTab",active:!0,danger:!1,element:null},{id:"courses-tab",name:"\u6279\u6539\u8AB2\u7A0B\u8A2D\u5B9A",target:"coursesTab",active:!1,danger:!1,element:null},{id:"tasks-tab",name:"\u6279\u6539\u4EFB\u52D9\u8A2D\u5B9A",target:"tasksTab",active:!1,danger:!1,element:null}]);return ms(()=>{const a=os.params.id;M(a),z(),Ls(q,O)}),H(()=>p.value,async()=>{p.value&&(await hs(p.value),_s())}),(a,t)=>{const o=K("router-link"),r=K("v-select");return d(),c("div",Cs,[s("header",As,[s("nav",$s,[s("ol",Gs,[s("li",Ds,[Q(o,{to:"/admin/assistants/list"},{default:gs(()=>[P(" \u52A9\u6559\u7BA1\u7406 ")]),_:1})]),Vs])]),Es]),s("div",Ss,[s("div",Ns,[s("div",Us,[Ms,s("h5",Ps,v(h.value.nickname),1)]),s("div",zs,[s("p",Bs,[js,P(" "+v(h.value.email),1)]),s("div",Fs,[Is,s("div",null,[(d(!0),c(b,null,m(h.value.assistant_titles,e=>(d(),c("span",{key:e.id,class:"badge bg-light text-dark me-1"},v(e.name),1))),128))])])])])]),s("div",Rs,[s("ul",qs,[(d(!0),c(b,null,m(O,e=>(d(),c("li",{class:"nav-item",role:"presentation",key:e.id},[s("button",{class:fs(["nav-link border",{active:e.active,"text-danger bg-danger bg-opacity-10":e.danger}]),id:e.id,type:"button",role:"tab","aria-controls":e.id,"aria-selected":"true","data-bs-target":`#${e.target}`,ref_for:!0,ref:i=>q.push(i),onClick:ys(i=>e.element.show(),["prevent"])},v(e.name),11,Os)]))),128))])]),s("div",Hs,[s("div",Js,[s("div",Ks,[Qs,s("div",Ws,[s("ul",Xs,[(d(!0),c(b,null,m(N.value,e=>(d(),c("li",{key:e.id,class:"list-item"},[s("div",Ys,[G(s("input",{id:e.name,"onUpdate:modelValue":t[0]||(t[0]=i=>L.value=i),class:"form-check-input",type:"checkbox",value:e.id,checked:e.isChecked},null,8,Zs),[[D,L.value]]),s("span",{class:"d-inline-block rounded-pill me-1",style:ws([{width:"10px",height:"10px"},`background-color:${e.color_code}`])},null,4),s("label",{class:"form-check-label",for:e.name},v(e.name),9,se)]),ee]))),128))])]),s("div",te,[s("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=e=>I(h.value.user_id))}," \u66F4\u65B0 ")])])]),s("div",ae,[s("div",oe,[s("div",le,[s("div",ie,[ne,s("div",de,[s("ul",ce,[(d(!0),c(b,null,m(h.value.video_courses,e=>(d(),c("li",{key:e.id,class:"list-item"},[P(v(e.name)+" ",1),re]))),128))])])])]),s("div",ue,[s("div",he,[s("div",_e,[s("div",ve,[G(s("input",{id:"assistantAll","onUpdate:modelValue":t[2]||(t[2]=e=>w.value=e),class:"form-check-input",type:"checkbox",onChange:ls},null,544),[[D,w.value]]),pe])]),s("div",be,[s("ul",me,[(d(!0),c(b,null,m(y.value,e=>(d(),c("li",{key:e.id,class:"list-item"},[s("div",ge,[G(s("input",{id:e.id,"onUpdate:modelValue":t[3]||(t[3]=i=>_.value=i),class:"form-check-input",type:"checkbox",value:e.id,checked:e.isChecked},null,8,ke),[[D,_.value]]),s("label",{class:"form-check-label",for:e.id},v(e.name),9,fe)]),ye]))),128))])]),s("div",we,[s("button",{type:"button",class:"btn btn-primary",onClick:t[4]||(t[4]=e=>I(h.value.user_id))}," \u66F4\u65B0 ")])])])])]),s("div",Le,[s("div",xe,[s("div",Te,[s("div",Ce,[Ae,s("div",$e,[s("ul",Ge,[(d(!0),c(b,null,m(h.value.task_groups,e=>(d(),c("li",{key:e.id,class:"mb-2 task-group"},[s("a",{class:"d-flex justify-content-between align-items-center text-decoration-none bg-light text-primary rounded mb-1 px-2 py-1","data-bs-toggle":"collapse",role:"button","aria-expanded":"false","aria-controls":e.id,href:`#checkedTaskList-${e.id}`},[s("span",Ve,v(e.name),1)],8,De),s("div",{class:"collapse",id:`checkedTaskList-${e.id}`},[s("ul",Se,[(d(!0),c(b,null,m(e.tasks,i=>(d(),c("li",{key:i.id,class:"list-item px-1 mb-1 task-item"},v(i.name),1))),128))])],8,Ee)]))),128))])])])]),s("div",Ne,[s("div",Ue,[Me,s("div",Pe,[Q(r,{id:"v-select",class:"mb-2",modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=e=>p.value=e),options:U.value,label:"name",clearable:!1,reduce:e=>e.id},null,8,["modelValue","options","reduce"]),p.value?(d(),c("div",ze,[G(s("input",{id:"tasksAll","onUpdate:modelValue":t[6]||(t[6]=e=>$.value=e),class:"form-check-input",type:"checkbox",onChange:R},null,544),[[D,$.value]]),Be])):ks("",!0),s("ul",je,[(d(!0),c(b,null,m(T.value,e=>(d(),c("li",{class:"list-item",key:e.id},[s("div",Fe,[G(s("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=i=>u.value=i),id:e.id,value:{task_group_id:p.value,id:e.id}},null,8,Ie),[[D,u.value]]),s("label",{class:"form-check-label",for:e.id},v(e.name),9,Re)]),qe]))),128))])]),s("div",Oe,[s("button",{type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=e=>vs(h.value.user_id))}," \u66F4\u65B0\u4EFB\u52D9 ")])])])])])])])}}};export{st as default};
