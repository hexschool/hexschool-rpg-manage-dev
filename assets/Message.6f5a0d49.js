import{r as f,n as P,a as c,c as d,b as e,h as y,i as _,F as L,q as C,w as H,v as N,A as T,k as B,_ as G,j as I,G as $,E as k,p as R,S as z,T as O,D as q,o as V,x as m}from"./index.4bfca30a.js";import{_ as J}from"./Editor.26a51a9d.js";import{g as j}from"./date.4b83de04.js";import{a as K}from"./notification.affb5561.js";const Q={class:"card shadow-sm rounded-4 overflow-hidden mb-4 position-relative"},W={class:"card-body"},X={class:"card-title mb-3"},Y={class:"mb-3 border-bottom"},Z=e("h6",null,"\u89F8\u767C\u689D\u4EF6",-1),ee={class:"mb-3 border-bottom"},se=e("h6",null,"\u53EF\u7528\u6B04\u4F4D",-1),te={class:"table table-borderless"},ae=e("thead",null,[e("tr",null,[e("th",{width:"100"}," \u6B04\u4F4D\u540D\u7A31 "),e("th",{width:"200"}," \u8B8A\u6578 "),e("th",null,"\u6E2C\u8A66\u5C08\u7528\u6E2C\u8A66\u6587\u5B57")])],-1),ne=["id","onUpdate:modelValue"],oe=B('<div class="row"><div class="col-md-6"><div class="mb-3"><label for="message_url" class="form-label">\u5C0D\u61C9\u9023\u7D50</label><input id="message_url" disabled type="text" class="form-control" value="/course/{% course_id %}"></div></div></div>',1),ie={class:"mb-3"},le=e("label",{for:"mail_content",class:"form-label"},"\u8A0A\u606F\u5167\u5BB9",-1),ce={class:"d-flex justify-content-between mt-5"},de={__name:"Message",props:{data:{type:Object,default:()=>({})}},emits:["messageTest","editMessage"],setup(h,{emit:v}){const b=h,g=f(null),{data:o}=P(b),u=(i,a)=>{const s=[];a.forEach(t=>{s.push({id:t.id,content:t.replace_keyword})}),v("messageTest",i,s)},w=(i,a)=>{const s={cht_name:a.cht_name,content:g.value.editorContent};v("editMessage",i,s)};return(i,a)=>(c(),d("div",Q,[e("div",W,[e("h4",X,y(_(o).cht_name)+"\u56DE\u994B ",1),e("div",Y,[Z,e("p",null,y(_(o).trigger_description),1)]),e("div",ee,[se,e("table",te,[ae,e("tbody",null,[(c(!0),d(L,null,C(_(o).variables,s=>(c(),d("tr",{key:`message_${s.id}`},[e("td",null,y(s.cht_name),1),e("td",null,"{% "+y(s.name)+" %}",1),e("td",null,[H(e("input",{id:s.name,"onUpdate:modelValue":t=>s.replace_keyword=t,type:"text",class:"form-control"},null,8,ne),[[N,s.replace_keyword]])])]))),128))])])]),oe,e("div",ie,[le,T(J,{ref_key:"editorRef",ref:g,content:_(o).content},null,8,["content"])]),e("div",ce,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:a[0]||(a[0]=s=>u(_(o).id,_(o).variables,_(o).content))}," \u6E2C\u8A66\u767C\u9001 "),e("button",{type:"button",class:"btn btn-secondary",onClick:a[1]||(a[1]=s=>w(_(o).id,h.data))}," \u78BA\u8A8D\u66F4\u65B0 ")])])]))}};const D=h=>(z("data-v-16a97308"),h=h(),O(),h),re={class:"mt-5"},_e={class:"right dropdown-container expanded"},ue={id:"notification",class:"position-fixed",style:{bottom:"30px",right:"40px","z-index":"10000"}},he=D(()=>e("span",{class:"material-icons"}," notifications ",-1)),pe=[he],me={class:"tabs"},ve={class:"h_tabs-nav d-flex p-0 list-unstyled"},ge={class:"h_notice_content"},fe={key:0,id:"h_unread_notice",class:"h_notice_area"},ye={class:"d-flex"},be=D(()=>e("div",{class:"d-flex flex-column align-items-center"},[e("img",{src:"https://fakeimg.pl/300/",alt:"",width:"48",height:"48",class:"rounded-circle"})],-1)),we={class:"media-body ms-2"},Me=["innerHTML"],xe={class:"d-inline-block text-muted"},$e={style:{width:"10px"}},ke=["onClick"],Le={key:1,id:"h_all_notice",class:"h_notice_area"},Ce={class:"d-flex"},Te=D(()=>e("div",{class:"d-flex flex-column align-items-center"},[e("img",{src:"https://fakeimg.pl/300/",alt:"",width:"48",height:"48",class:"rounded-circle"})],-1)),De={class:"media-body ms-2"},Ue=["innerHTML"],Ie={class:"d-inline-block text-muted"},Re=["onClick"],Ve={__name:"MessageFront",props:{data:{type:Array}},emits:["readMessage","unreadMessage"],setup(h,{emit:v}){const b=h,{data:g}=P(b),o=f(!1),u=f("h_unread_notice"),w=I(()=>g.value.filter(a=>!!a.has_read).reverse()),i=I(()=>g.value.filter(a=>!a.has_read).reverse());return(a,s)=>(c(),d("div",re,[e("div",_e,[e("div",ue,[e("a",{href:"#","data-dropdown":"notificationMenu",class:"notification-icon d-flex align-items-center justify-content-center rounded-circle text-decoration-none text-primary",onClick:s[0]||(s[0]=$(t=>o.value=!o.value,["prevent"]))},pe)]),e("ul",{name:"notificationMenu",class:k(["h_dropdown shadow bg-white m-0 p-0 rounded-4 overflow-hidden",{show:o.value}])},[e("div",me,[e("ul",ve,[e("li",{class:k(["flex-fill",{"tab-active":u.value=="h_unread_notice"}])},[e("a",{href:"#h_unread_notice",onClick:s[1]||(s[1]=$(t=>u.value="h_unread_notice",["prevent"]))}," \u672A\u8B80\u901A\u77E5 ")],2),e("li",{class:k(["flex-fill",{"tab-active":u.value=="h_all_notice"}])},[e("a",{href:"#h_all_notice",onClick:s[2]||(s[2]=$(t=>u.value="h_all_notice",["prevent"]))}," \u5DF2\u8B80\u901A\u77E5 ")],2)]),e("div",ge,[u.value=="h_unread_notice"?(c(),d("div",fe,[e("div",null,[(c(!0),d(L,null,C(_(i),t=>(c(),d("li",{key:t.id,class:"notification-group p-2 d-flex justify-content-between"},[e("div",ye,[be,e("div",we,[e("p",{class:"mt-0 mb-0",innerHTML:t.content},null,8,Me),e("small",null,[e("span",xe,y(_(j)(t.create_time)),1)])])]),e("div",$e,[e("span",{class:"un read",onClick:M=>v("readMessage",t.id)},null,8,ke)])]))),128))])])):R("",!0),u.value=="h_all_notice"?(c(),d("div",Le,[e("div",null,[(c(!0),d(L,null,C(_(w),t=>(c(),d("li",{key:t.id,class:"notification-group p-2 d-flex justify-content-between"},[e("div",Ce,[Te,e("div",De,[e("p",{class:"mt-0 mb-0",innerHTML:t.content},null,8,Ue),e("small",null,[e("span",Ie,y(_(j)(t.create_time)),1)])])]),e("span",{class:"read",onClick:M=>v("unreadMessage",t.id)},null,8,Re)]))),128))])])):R("",!0)])])],2)])]))}},je=G(Ve,[["__scopeId","data-v-16a97308"]]),Pe={class:"px-4 mt-4"},Se=e("h4",{class:"mb-3"}," \u7AD9\u5167\u901A\u77E5\u8A0A\u606F ",-1),Fe={class:"row"},Ae={class:"col-md-3"},Ee={class:"list-group"},He=["onClick"],Ne={class:"col-md-9"},qe={__name:"Message",setup(h){const{apiGetMessageList:v,apiGetUserMessageList:b,apiPutUserMessageRead:g,apiPutUserMessageUnread:o,apiPostMessageTest:u,apiPutMessageTemplate:w}=K,i=q.useLoading(),a=f(1),s=f(null),t=f({}),M=async()=>{const r=i.show();try{const{templates:n}=await v();s.value=n,[t.value]=s.value}catch(n){m("danger","\u901A\u77E5\u5217\u8868\u51FA\u73FE\u932F\u8AA4",n.response.data.message)}finally{r.hide()}};V(()=>{M()});const U=f([]),x=async()=>{const r=i.show();try{const{messages:n}=await b();U.value=n}catch(n){m("danger","\u53D6\u5F97\u7AD9\u5167\u8A0A\u606F\u5931\u6557",n.response.data.message)}finally{r.hide()}};V(()=>{x()});const S=async r=>{const n=i.show();try{await g(r),x()}catch(l){m("danger","\u5DF2\u8B80\u5931\u6557",l.response.data.message)}finally{n.hide()}},F=async r=>{const n=i.show();try{await o(r),x()}catch(l){m("danger","\u5DF2\u8B80\u5931\u6557",l.response.data.message)}finally{n.hide()}},A=async(r,n)=>{const l=i.show();try{const{message:p}=await u(r,n);m("success","\u901A\u77E5\u6E2C\u8A66\u7D50\u679C",p),x()}catch(p){m("danger","\u6E2C\u8A66 API \u51FA\u73FE\u932F\u8AA4",p.response.data.message)}finally{l.hide()}},E=async(r,n)=>{const l=i.show();try{const{message:p}=await w(r,n);m("success","\u901A\u77E5\u6A23\u677F\u66F4\u65B0\u7D50\u679C",p),a.value=1,M()}catch(p){m("danger","\u7DE8\u8F2F\u7AD9\u5167\u8A0A\u606F\u6A23\u677F\u51FA\u73FE\u932F\u8AA4",p.response.data.message)}finally{l.hide()}};return(r,n)=>(c(),d("div",Pe,[Se,e("div",Fe,[e("div",Ae,[e("div",Ee,[(c(!0),d(L,null,C(s.value,l=>(c(),d("a",{key:l.id,href:"#",class:k(["list-group-item",a.value===l.id?"active":""]),onClick:$(p=>(t.value=l,a.value=l.id),["prevent"])},y(l.cht_name),11,He))),128))])]),e("div",Ne,[T(de,{data:t.value,onMessageTest:A,onEditMessage:E},null,8,["data"]),T(je,{data:U.value,onReadMessage:S,onUnreadMessage:F},null,8,["data"])])])]))}};export{qe as default};
