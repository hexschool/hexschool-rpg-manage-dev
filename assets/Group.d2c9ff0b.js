import{r as d,s as X,z as P,a as c,e as j,f as C,A as u,b as e,E as L,w as K,C as H,M as Y,_ as Z,D as ee,o as se,c as _,v as te,O as ae,F as N,q as R,i as oe,x as B,B as le,G as ne,h as x,p as z,g as I,P as ie,S as de,T as re}from"./index.4bfca30a.js";import{a as J}from"./task.af703141.js";import{a as ce}from"./task-tags.fb9d6aeb.js";const ue={class:"row"},pe={class:"col-6"},ve={class:"mb-3"},me=e("label",{for:"taskGroupName",class:"form-label text-dark"},"\u4EFB\u52D9\u7FA4\u7D44\u540D\u7A31",-1),_e={class:"col-6"},ke={class:"mb-3"},be=e("label",{for:"taskGroupKeyword",class:"form-label text-dark"},"\u82F1\u6587\u540D\u7A31",-1),fe={class:"mb-3"},ge=e("label",{for:"taskGroupDescription",class:"form-label text-dark"},"\u4EFB\u52D9\u7FA4\u7D44\u63CF\u8FF0",-1),ye={class:"mb-3"},he=e("label",{for:"taskGroupEndDate",class:"form-label text-dark"},"\u5230\u671F\u65E5",-1),we={class:"form-check"},xe=e("label",{for:"taskGroupEnable",class:"form-check-label text-dark"},"\u662F\u5426\u986F\u793A",-1),Ge=["disabled"],$e={__name:"CreateTaskGroupModal",props:{tempTaskGroupData:{type:Object,default(){return{}}}},emits:["createTaskGroupMethod"],setup(G,{expose:q,emit:S}){const E=G,{apiPostTaskGroup:k}=J,m=d(),t=d({name:"",keyword:"",description:"",expired_at:"",enable:!1}),U=d(null);X(()=>{t.value=E.tempTaskGroupData});const V=async()=>{let g={};try{t.value.expired_at?g={name:t.value.name,keyword:t.value.keyword,description:t.value.description,expired_at:new Date(t.value.expired_at).toISOString(),enable:t.value.enable}:g={name:t.value.name,keyword:t.value.keyword,description:t.value.description,enable:t.value.enable},await k(g),S("createTaskGroupMethod",{target:"import",type:"\u6210\u529F"}),m.value.resetForm(),t.value.enable=!1}catch(n){S("createTaskGroupMethod",{target:"import",type:"\u5931\u6557",error:`${n.response.status}:${n.response.data.message}`})}};return q({createTaskGroupModalRef:U}),(g,n)=>{const y=P("Field"),$=P("ErrorMessage"),T=P("VForm");return c(),j(T,{ref_key:"formRef",ref:m,onSubmit:V},{default:C(({errors:b,invalid:M})=>[u(Y,{id:"createTaskGroupModal",ref_key:"createTaskGroupModalRef",ref:U,"has-footer":!0,title:"\u65B0\u589E\u4EFB\u52D9\u7FA4\u7D44","class-list":""},{body:C(()=>[e("div",ue,[e("div",pe,[e("div",ve,[me,u(y,{id:"taskGroupName",modelValue:t.value.name,"onUpdate:modelValue":n[0]||(n[0]=p=>t.value.name=p),name:"\u4EFB\u52D9\u7FA4\u7D44\u540D\u7A31",type:"text",class:L(["form-control",{"is-invalid":b.\u4EFB\u52D9\u7FA4\u7D44\u540D\u7A31}]),rules:"required"},null,8,["modelValue","class"]),u($,{name:"\u4EFB\u52D9\u7FA4\u7D44\u540D\u7A31",class:"invalid-feedback"})])]),e("div",_e,[e("div",ke,[be,u(y,{id:"taskGroupKeyword",modelValue:t.value.keyword,"onUpdate:modelValue":n[1]||(n[1]=p=>t.value.keyword=p),name:"\u82F1\u6587\u540D\u7A31",type:"text",class:L(["form-control",{"is-invalid":b.\u82F1\u6587\u540D\u7A31}]),rules:"required"},null,8,["modelValue","class"]),u($,{name:"\u82F1\u6587\u540D\u7A31",class:"invalid-feedback"})])])]),e("div",fe,[ge,u(y,{id:"taskGroupDescription",modelValue:t.value.description,"onUpdate:modelValue":n[2]||(n[2]=p=>t.value.description=p),as:"textarea",name:"\u4EFB\u52D9\u7FA4\u7D44\u63CF\u8FF0",type:"text",class:L(["form-control",{"is-invalid":b.\u4EFB\u52D9\u7FA4\u7D44\u63CF\u8FF0}]),rules:"required"},null,8,["modelValue","class"]),u($,{name:"\u4EFB\u52D9\u7FA4\u7D44\u63CF\u8FF0",class:"invalid-feedback"})]),e("div",ye,[he,u(y,{id:"taskGroupEndDate",modelValue:t.value.expired_at,"onUpdate:modelValue":n[3]||(n[3]=p=>t.value.expired_at=p),name:"\u5230\u671F\u65E5",type:"date",class:L(["form-control",{"is-invalid":b.\u5230\u671F\u65E5}])},null,8,["modelValue","class"]),u($,{name:"\u5230\u671F\u65E5",class:"invalid-feedback"})]),e("div",we,[K(e("input",{type:"checkbox",id:"taskGroupEnable",class:"form-check-input","onUpdate:modelValue":n[4]||(n[4]=p=>t.value.enable=p)},null,512),[[H,t.value.enable]]),xe])]),footer:C(()=>[e("button",{type:"submit",disabled:M,class:"btn btn-primary"}," \u5EFA\u7ACB ",8,Ge)]),_:2},1536)]),_:1},512)}}};const D=G=>(de("data-v-9c41d8b7"),G=G(),re(),G),Te={class:"taskGroups px-4 mt-4"},Me=D(()=>e("h1",{class:"fs-4 mb-3"},"\u4EFB\u52D9\u7FA4\u7D44",-1)),Ve={class:"d-flex justify-content-between align-items-center mb-3"},Le={class:"row w-75"},Ce={class:"col-md-6"},De=D(()=>e("p",{class:"mb-1"},"\u6A19\u7C64\u7BE9\u9078",-1)),Se={class:"list-unstyled d-flex flex-wrap mb-2"},Ee=["value","onClick","id"],Ue=["for"],Fe={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Ne={class:"card-body p-0"},Re={class:"table-responsive"},Be={class:"table table-hover mb-0 text-nowrap",style:{"font-size":"14px"}},Pe=D(()=>e("thead",{class:"bg-light"},[e("tr",null,[e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"}," \u7FA4\u7D44\u540D\u7A31 "),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u82F1\u6587\u540D\u7A31"),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u4F7F\u7528\u8005\u7FA4\u7D44"),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u5206\u985E\u6A19\u7C64"),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u662F\u5426\u986F\u793A"),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u5230\u671F\u6642\u9593"),e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"},"\u7DE8\u8F2F")])],-1)),qe={class:"text-nowrap"},Ae={scope:"row",class:"ps-4"},Ie={scope:"row",class:"ps-4"},Ke={scope:"row",class:"ps-4"},Oe={key:0},ze={key:0},je={scope:"row",class:"ps-4"},He={scope:"row",class:"ps-4"},Je={scope:"row",class:"ps-4"},Qe=D(()=>e("span",{class:"material-icons align-middle fs-6"}," edit ",-1)),We=["onClick"],Xe=D(()=>e("span",{class:"material-icons align-middle fs-6"}," content_copy ",-1)),Ye={class:"card-footer bg-white py-3"},Ze={class:"d-flex flex-wrap align-items-start"},es={__name:"Group",setup(G){const{apiGetTaskGroupsList:q}=J,{apiGetTaskTags:S}=ce,E=ee.useLoading(),k=d({taskGroupsList:[],pagination:{total:10,count:10,total_page:10,current_page:1}}),m=d(""),t=async(o=1)=>{var f,s,i,w;const a=E.show();try{const{task_groups:l,pagination:F}=await q({page:o,scoped:m.value});k.value.taskGroupsList=l,k.value.pagination=F}catch(l){B("danger","\u53D6\u5F97\u4EFB\u52D9\u7FA4\u7D44\u5217\u8868\u5931\u6557",`${(s=(f=l==null?void 0:l.response)==null?void 0:f.data)==null?void 0:s.statusCode} : ${(w=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:w.message}`)}finally{a.hide()}},U=o=>{t(o)},V=d(""),g=d(null),n=d({}),y=(o,a)=>{o==="copy"?n.value={...a}:o==="add"&&(n.value={}),V.value.show()},$=o=>{o.type==="\u6210\u529F"?B("success","\u5EFA\u7ACB\u4EFB\u52D9\u7FA4\u7D44\u6210\u529F","\u5DF2\u6210\u529F\u5EFA\u7ACB\u4EFB\u52D9\u7FA4\u7D44"):o.type==="\u5931\u6557"&&B("danger","\u5EFA\u7ACB\u4EFB\u52D9\u7FA4\u7D44\u5931\u6557",o.error),V.value.hide(),t()},T=d({tagList:[],pagination:{total:100,count:10,total_page:10,current_page:1}}),b=d([]),M=d(1),p=async(o=1)=>{var f,s,i,w;const a=E.show();try{const{task_tags:l,pagination:F}=await S({page:o,count:100});T.value.tagList=l,T.value.pagination=F,M.value=F.current_page,b.value=[...b.value,...l]}catch(l){B("danger","\u53D6\u5F97\u5206\u985E\u6A19\u7C64\u5217\u8868\u5931\u6557",`${(s=(f=l==null?void 0:l.response)==null?void 0:f.data)==null?void 0:s.statusCode}:${(w=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:w.message}`)}finally{a.hide()}},O=async(o=1)=>{await p(o),T.value.pagination.total_page!==0&&M.value!==T.value.pagination.total_page&&(M.value+=1,O(M.value))},A=d(!1),r=d(""),h=d([]),v=d(""),Q=()=>{r.value=r.value.trim(),v.value&&r.value?m.value=`&keyword=${r.value}&task_tags=${v.value}`:v.value||r.value?m.value=`${r.value?`&keyword=${r.value}`:""}${v.value?`&task_tags=${v.value}`:""}`:m.value="",t()},W=o=>{h.value.includes(o)?h.value=h.value.filter(a=>a!==o):h.value.push(o),v.value=h.value.toString(),v.value&&r.value?m.value=`&keyword=${r.value}&task_tags=${v.value}`:v.value||r.value?m.value=`${r.value?`&keyword=${r.value}`:""}${v.value?`&task_tags=${v.value}`:""}`:m.value="",t()};return se(async()=>{await t(),O(),V.value=new le(g.value.createTaskGroupModalRef.hModal)}),(o,a)=>{const f=P("router-link");return c(),_("div",Te,[Me,e("div",Ve,[e("div",Le,[e("div",Ce,[K(e("input",{onCompositionstart:a[0]||(a[0]=s=>A.value=!0),onCompositionend:a[1]||(a[1]=s=>A.value=!1),placeholder:"\u641C\u5C0B\u4EFB\u52D9\u7FA4\u7D44\u540D\u7A31\u3001\u82F1\u6587\u540D\u7A31",class:"form-control",type:"text","onUpdate:modelValue":a[2]||(a[2]=s=>r.value=s),onKeydown:a[3]||(a[3]=ae(ne(()=>{A.value||Q()},["prevent"]),["enter"]))},null,544),[[te,r.value]])])]),e("button",{type:"button",class:"btn btn-primary",onClick:a[4]||(a[4]=s=>y("add"))}," \u65B0\u589E\u7FA4\u7D44 ")]),De,e("ul",Se,[(c(!0),_(N,null,R(b.value,s=>(c(),_("li",{key:s.id,class:"me-2 mb-2"},[K(e("input",{type:"checkbox",class:"btn-check","onUpdate:modelValue":a[5]||(a[5]=i=>h.value=i),value:s.id,onClick:i=>W(s.id),id:`btn-tag-${s.id}`},null,8,Ee),[[H,h.value]]),e("label",{class:"btn btn-sm custom-btn-primary-tag",for:`btn-tag-${s.id}`},x(s.name),9,Ue)]))),128))]),e("div",Fe,[e("div",Ne,[e("div",Re,[e("table",Be,[Pe,e("tbody",qe,[(c(!0),_(N,null,R(k.value.taskGroupsList,s=>(c(),_("tr",{key:s.id,class:"align-middle"},[e("td",Ae,x(s.name),1),e("td",Ie,x(s.keyword),1),e("td",Ke,[s.user_groups.length===0?(c(),_("span",Oe,"\u7121")):z("",!0),(c(!0),_(N,null,R(s.user_groups,(i,w)=>(c(),j(f,{key:i.id,target:"_blank",to:`/admin/users/groups/${i.id}`},{default:C(()=>[I(x(i.name)+" ",1),s.user_groups.length>1&&w<s.user_groups.length-1?(c(),_("span",ze,"\u3001")):z("",!0)]),_:2},1032,["to"]))),128))]),e("td",je,[(c(!0),_(N,null,R(s.tags,i=>(c(),_("span",{key:i,class:"badge bg-light text-primary me-1"},x(i),1))),128))]),e("td",{scope:"row",class:L(["ps-4",{"text-success":s.enable}])},x(s.enable?"\u662F":"\u5426"),3),e("td",He,x(new Date(s.expired_at).toLocaleDateString("sv-SE")),1),e("td",Je,[u(f,{to:`/admin/task/group/${s.id}`,class:"btn btn-sm btn-outline-gray ms-1"},{default:C(()=>[Qe,I(" \u7DE8\u8F2F ")]),_:2},1032,["to"]),e("button",{class:"btn btn-sm btn-outline-gray ms-1",type:"button",onClick:i=>y("copy",s)},[Xe,I(" \u8907\u88FD ")],8,We)])]))),128))])])])]),e("div",Ye,[e("div",Ze,[u(oe(ie),{modelValue:k.value.pagination.current_page,"onUpdate:modelValue":a[6]||(a[6]=s=>k.value.pagination.current_page=s),records:k.value.pagination.total,"per-page":10,options:{chunk:6},onPaginate:U},null,8,["modelValue","records"])])])]),u($e,{ref_key:"createTaskGroupModalComponentRef",ref:g,"temp-task-group-data":n.value,onCreateTaskGroupMethod:$},null,8,["temp-task-group-data"])])}}},ls=Z(es,[["__scopeId","data-v-9c41d8b7"]]);export{ls as default};
