import{l as ce,r as l,s as Ue,o as O,z as C,a as r,e as ue,f as w,A as u,b as e,E as te,c as i,h as m,g as B,F as E,q as j,p as H,M as pe,i as k,y as me,t as $e,B as be,j as Ce,w as J,v as ve,D as Te,Q as Ve,R as Ge,O as Ie,x as d,C as De,L as Le,G as ie,P as Be}from"./index.4bfca30a.js";import{B as Se}from"./tab.3aba35c3.js";const Re={class:"mb-3"},Fe=e("label",{for:"exportByO",class:"form-label"},"\u5927\u91CF\u4F7F\u7528\u8005\u532F\u5165",-1),Ae=e("div",{class:"p-2 bg-light rounded mb-2"},[e("p",{class:"text-muted mb-0"},[e("small",null," \u7BC4\u4F8B\u683C\u5F0F\uFF1Atest@gmail.com, test1@gmail.com ")])],-1),Ee={key:0,class:"bg-light p-2 rounded"},je={class:"text-danger"},Oe=["disabled"],Ne={__name:"CreateUsersModal",props:{tempUsers:{type:Object,default(){return{}}}},emits:["createUsersMethod"],setup(N,{expose:S,emit:T}){const R=N,{apiPostUserImport:g}=me,f=ce(),y=l(),x=l({});Ue(()=>R.tempUsers.name,()=>{x.value=R.tempUsers});const _=l(""),F=()=>_.value.split(/[\n,\s]+/),b=l({}),v=async h=>{try{const c={user_emails:F()},V=await g(h,c),{total:G,failed:M,failed_message:U}=V.result;b.value={total:G,failed:M,failedMessage:U},T("createUsersMethod",{target:"import",type:"\u6210\u529F"}),y.value.resetForm()}catch(c){T("createUsersMethod",{target:"import",type:"\u5931\u6557",error:`${c.response.data.statusCode}:${c.response.data.message}`})}},n=l(null);return O(()=>{n.value.hModal.addEventListener("hidden.bs.modal",()=>{b.value={}})}),S({createUsersModalRef:n}),(h,c)=>{const V=C("Field"),G=C("ErrorMessage"),M=C("VForm");return r(),ue(M,{ref_key:"refs",ref:y,onSubmit:c[1]||(c[1]=U=>v(k(f).params.id))},{default:w(({errors:U,meta:p})=>[u(pe,{ref_key:"createUsersModalRef",ref:n,"has-footer":!0,title:"\u532F\u5165\u4F7F\u7528\u8005","class-list":""},{body:w(()=>{var I;return[e("div",Re,[Fe,Ae,u(V,{as:"textarea",id:"exportByOne",modelValue:_.value,"onUpdate:modelValue":c[0]||(c[0]=$=>_.value=$),name:"exportByOne",label:"\u5927\u91CF\u4F7F\u7528\u8005\u532F\u5165",type:"text",class:te(["form-control",{"is-invalid":U.exportByOne}])},null,8,["modelValue","class"]),u(G,{name:"exportByOne",class:"invalid-feedback"})]),(I=b.value)!=null&&I.failed?(r(),i("div",Ee,[e("p",null,[e("small",null,"\u5171\u532F\u5165 "+m(b.value.total)+" \u4F4D",1),B("\uFF0C"),e("small",je,"\u5931\u6557 "+m(b.value.failed)+" \u4F4D",1)]),(r(!0),i(E,null,j(b.value.failedMessage,($,W)=>(r(),i("ul",{key:W},[e("li",null,[e("small",null,m($.email)+" : "+m($.message),1)])]))),128))])):H("",!0)]}),footer:w(()=>[e("button",{type:"submit",disabled:!p.valid,class:"btn btn-primary"}," \u532F\u5165 ",8,Oe)]),_:2},1536)]),_:1},512)}}},Pe={class:"mb-4"},qe={for:"title"},ze=["disabled"],Ke={__name:"DangerActionsModal",props:{body:{type:Object,default(){return{userId:String,name:String,type:String}}}},emits:["danger-user-method"],setup(N,{expose:S,emit:T}){const g=$e(N,"body"),f=l(""),y=l(null),x=l(null);O(()=>{y.value=new be(x.value.hModal),x.value.hModal.addEventListener("hidden.bs.modal",()=>{f.value=""})});const _=Ce(()=>{const{type:n}=g.value;return n==="deleteUserGroupIdUser"?{title:"\u662F\u5426\u522A\u9664\u6B64\u4F7F\u7528\u8005\u7FA4\u7D44\u4E0B\u7684\u5B78\u751F\uFF1F",body:{label:"\u8ACB\u518D\u6B21\u8F38\u5165\u5B78\u751F\u540D\u7A31",btn:"\u522A\u9664"}}:{body:{}}}),F=()=>{y.value.show()},b=()=>{y.value.hide()},v=()=>{const{type:n,userId:h}=g.value;T("danger-user-method",{userId:h,type:n})};return S({openModal:F,hideModal:b}),(n,h)=>(r(),ue(pe,{id:"userDangerActions",ref_key:"myModal",ref:x,"has-footer":!0,title:k(_).title},{body:w(()=>[e("p",Pe,m(k(g).name),1),e("label",qe,m(k(_).body.label),1),J(e("input",{id:"title","onUpdate:modelValue":h[0]||(h[0]=c=>f.value=c),type:"text",class:"form-control"},null,512),[[ve,f.value]])]),footer:w(()=>[e("button",{type:"button",class:"btn btn-primary",onClick:b},"\u53D6\u6D88"),e("button",{disabled:f.value!==k(g).name,type:"button",class:"btn btn-danger",onClick:v},m(k(_).body.btn),9,ze)]),_:1},8,["title"]))}},Qe={class:"about px-4 mt-4"},He={class:"border-bottom border-light pb-2 mb-4"},Je={"aria-label":"breadcrumb"},We={class:"breadcrumb"},Xe={class:"breadcrumb-item"},Ye=e("li",{class:"breadcrumb-item active","aria-current":"page"}," \u7DE8\u8F2F\u4F7F\u7528\u8005\u7FA4\u7D44 ",-1),Ze={class:"d-flex justify-content-between align-items-center"},et=e("h1",{class:"fs-4 mb-0"},"\u7DE8\u8F2F\u4F7F\u7528\u8005\u7FA4\u7D44",-1),tt={class:"row mb-4"},st={class:"col-md-6"},at={class:"card shadow-sm rounded-4 overflow-hidden"},ot=e("div",{class:"card-header bg-white py-3"},[e("h2",{class:"fs-6 mb-0 lh-base"},"\u4F7F\u7528\u8005\u7FA4\u7D44")],-1),lt={class:"card-body"},nt={class:"mb-3"},rt=e("label",{for:"name",class:"form-label"},"\u540D\u7A31",-1),dt={class:"mb-3"},it=e("label",{for:"enName",class:"form-label"},"\u82F1\u6587\u540D\u7A31",-1),ct={class:"form-check"},ut=e("label",{class:"form-check-label",for:"flexCheckChecked"}," \u662F\u5426\u986F\u793A ",-1),pt={class:"card-footer bg-white py-3 d-flex justify-content-end"},mt=["disabled"],bt={class:"col-md-6"},vt={class:"card shadow-sm rounded-4 overflow-hidden h-100"},ht={class:"card-header bg-white py-2 d-flex align-items-center justify-content-between"},_t=e("h2",{class:"h6 mb-0 lh-base"},"\u5DF2\u4F7F\u7528\u670D\u52D9",-1),gt={class:"nav nav-pills",id:"pills-tab",role:"tablist"},ft={class:"nav-item",role:"presentation"},yt={class:"nav-item",role:"presentation"},kt={class:"nav-item",role:"presentation"},wt={class:"card-body",style:{"max-height":"230px","overflow-y":"scroll"}},xt={class:"tab-content",id:"pills-tabContent"},Mt={class:"tab-pane fade show active",id:"pills-home",role:"tabpanel","aria-labelledby":"pills-home-tab",tabindex:"0"},Ut={class:"mb-2"},$t={class:"tab-pane fade",id:"pills-profile",role:"tabpanel","aria-labelledby":"pills-profile-tab",tabindex:"0"},Ct={class:"tab-pane fade",id:"pills-contact",role:"tabpanel","aria-labelledby":"pills-contact-tab",tabindex:"0"},Tt={class:"card shadow-sm rounded-4 overflow-hidden mb-4"},Vt={class:"card-header bg-white py-3 d-flex justify-content-between align-items-center"},Gt={class:"d-flex align-items-center fs-6 mb-0"},It=e("span",{class:"material-icons text-primary align-middle"}," info ",-1),Dt=[It],Lt={class:"d-flex"},Bt={class:"row align-items-center"},St={class:"col-6 d-flex align-items-center"},Rt=e("label",{for:"filter",class:"form-label text-secondary w-50 mb-0"},[e("small",null,"\u641C\u5C0B:")],-1),Ft=e("option",{value:""},"\u5168\u90E8",-1),At=e("option",{selected:"",value:"email"},"Email",-1),Et=e("option",{value:"nickname"},"\u66B1\u7A31",-1),jt=[Ft,At,Et],Ot={class:"col-6"},Nt={class:"input-group align-items-center"},Pt=e("div",{class:"bg-white border-0"},[e("span",{class:"material-icons fs-6 align-middle"}," search ")],-1),qt={class:"card-body",style:{"max-height":"250px",overflow:"auto"}},zt={class:"display-12 fw-normal mb-3 position-relative rounded-3"},Kt={class:"table-responsive"},Qt={class:"table"},Ht=e("thead",{class:"bg-light"},[e("tr",null,[e("th",{scope:"col",class:"ps-4 py-3 text-muted border-0"}," \u540D\u7A31 "),e("th",{scope:"col",class:"py-3 text-muted border-0"},"\u4FE1\u7BB1"),e("th",{scope:"col",class:"py-3 text-muted pe-3 border-0 text-end"}," \u64CD\u4F5C ")])],-1),Jt={class:"text-nowrap"},Wt={scope:"row"},Xt={class:"text-end"},Yt=["onClick"],Zt={class:"d-flex justify-content-end"},es={key:0,class:"overlay rounded-3 position-absolute d-flex align-items-center justify-content-center",style:{top:"0",bottom:"0",left:"0",right:"0"}},ts={key:0,class:"spinner-border spinner-border-sm",role:"status"},ss=e("span",{class:"visually-hidden"},"Loading...",-1),as=[ss],ns={__name:"UserGroupDetail",setup(N){const{apiGetUserGroupId:S,apiGetTaskGroups:T,apiGetTasks:R,apiPutUserGroupId:g,apiGetUserGroupIdUsers:f,apiDeleteUserGroupIdUser:y,apiGetTraining:x,apiPostTeachableSync:_,apiGetTeachableSync:F}=me,b=ce(),v=Te.useLoading(),n=l(0),h=l(""),c=l(""),V=l(null),G=l(null),M=l(!1),U=l(!1),p=l({}),I=async o=>{const t=v.show();try{const{group:a}=await S(o);p.value=a,G.value.setContent({".tooltip-inner":`Teachable ${a.teachable_enrollments} \u4F4D<br>\u624B\u52D5\u532F\u5165 ${a.manual_enrollments} \u4F4D`})}catch(a){d("danger","\u53D6\u5F97\u8A73\u7D30\u8CC7\u8A0A\u5931\u6557",`${a.response.data.statusCode}:${a.response.data.message}`)}finally{t.hide()}};O(()=>{n.value=b.params.id,I(n.value)});const $=l([]),W=async o=>{const t=v.show();try{const{task_groups:a}=await T(o);$.value=a}catch(a){d("danger","\u53D6\u5F97\u5957\u7528\u7684\u4EFB\u52D9\u7FA4\u7D44\u5931\u6557",`${a.response.data.statusCode}:${a.response.data.message}`)}finally{t.hide()}},se=l([]),he=async o=>{const t=v.show();try{const{tasks:a}=await R(o);se.value=a}catch(a){d("danger","\u53D6\u5F97\u5957\u7528\u7684\u4EFB\u52D9\u5931\u6557",`${a.response.data.statusCode}:${a.response.data.message}`)}finally{t.hide()}},ae=l([]),_e=async o=>{const t=v.show();try{const{training_classes:a}=await x(o);ae.value=a}catch(a){d("danger","\u53D6\u5F97\u5957\u7528\u7684\u4EFB\u52D9\u5931\u6557",`${a.response.data.statusCode}:${a.response.data.message}`)}finally{t.hide()}},ge=async o=>{const t=v.show();try{const a={name:p.value.name,enable:p.value.enable};await g(o,a),d("success","\u4FEE\u6539\u4F7F\u7528\u8005\u7FA4\u7D44\u6210\u529F","\u5DF2\u6210\u529F\u4FEE\u6539\u4F7F\u7528\u8005\u7FA4\u7D44"),I(n.value)}catch(a){d("danger","\u4FEE\u6539\u4F7F\u7528\u8005\u7FA4\u7D44\u5931\u6557",`${a.response.data.statusCode}:${a.response.data.message}`)}finally{t.hide()}},oe=l({}),fe=o=>{o==="add"&&(oe.value={}),c.value.show()},le=l(null);O(()=>{c.value=new be(le.value.createUsersModalRef.hModal)});const ye=()=>{M.value=!0,U.value=!0},ne=l({}),P=l(""),X=l("email"),q=l({current_page:1,total:0}),D=async({groupId:o,filter:t,value:a,page:z,count:K})=>{const ee=v.show();try{const{users:s,pagination:Q}=await f({groupId:o,filter:t,value:a,page:z,count:K});ne.value=s,q.value=Q,ye()}catch(s){d("danger","\u53D6\u5F97\u5B78\u751F\u540D\u55AE\u5931\u6557",`${s.response.data.statusCode}:${s.response.data.message}`)}finally{ee.hide()}},ke=o=>{o.type==="\u6210\u529F"?(d("success","\u532F\u5165\u4F7F\u7528\u8005\u6210\u529F"),D({groupId:n.value})):d("danger","\u532F\u5165\u4F7F\u7528\u8005\u5931\u6557",o.error)},Y=l(null),re=l({}),we=({userId:o,type:t,name:a})=>{Y.value.openModal(),re.value={userId:o,type:t,name:a}},xe=async({userId:o,type:t})=>{try{t==="deleteUserGroupIdUser"&&(await y(n.value,o),await D({groupId:n.value})),d("success","\u5371\u96AA\u64CD\u4F5C\u6210\u529F\uFF0C\u4F7F\u7528\u8005\u5DF2\u7D93\u88AB\u522A\u9664\u3002")}catch(a){d("danger","\u5371\u96AA\u64CD\u4F5C\u5931\u6557\uFF0C\u8ACB\u91CD\u65B0\u64CD\u4F5C",a)}finally{Y.value.hideModal()}},A=l(!1),Z=l(0),de=async o=>{A.value=!0;const{is_sync:t}=await F(o);Z.value=t,Z.value?(d("danger","Teachable \u4F7F\u7528\u8005\u540C\u6B65","\u540C\u6B65\u4E2D\uFF0C10 \u79D2\u5F8C\u518D\u6B21\u78BA\u8A8D"),setTimeout(()=>{de(o)},1e4)):(d("success","Teachable \u4F7F\u7528\u8005\u540C\u6B65","\u540C\u6B65\u6210\u529F"),A.value=!1,await D({groupId:n.value}),await I(n.value))},Me=async o=>{A.value=!0;try{await _(o),await de(o),Z.value||d("success","Teachable \u4F7F\u7528\u8005\u540C\u6B65","\u540C\u6B65\u6210\u529F")}catch(t){d("danger","Teachable \u4F7F\u7528\u8005\u540C\u6B65",t.response.data.message),A.value=!1}};return O(()=>{h.value=document.querySelectorAll("#myTab button"),h.value.forEach(o=>{const t=new Se(o);o.addEventListener("click",a=>{a.preventDefault(),t.show()})}),G.value=new Ve(V.value,{html:!0})}),(o,t)=>{const a=C("router-link"),z=C("Field"),K=C("ErrorMessage"),ee=C("VForm");return r(),i("div",null,[e("div",Qe,[e("header",He,[e("nav",Je,[e("ol",We,[e("li",Xe,[u(a,{to:"/admin/users/groups"},{default:w(()=>[B(" \u4F7F\u7528\u8005\u7FA4\u7D44 ")]),_:1})]),Ye])]),e("div",Ze,[et,e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=s=>fe("add"))}," \u532F\u5165\u4F7F\u7528\u8005 ")])]),e("div",tt,[e("div",st,[u(ee,{ref:"refs",class:"h-100"},{default:w(({errors:s,meta:Q})=>[e("div",at,[ot,e("div",lt,[e("div",nt,[rt,u(z,{id:"name",modelValue:p.value.name,"onUpdate:modelValue":t[1]||(t[1]=L=>p.value.name=L),name:"name",label:"\u540D\u7A31",type:"text",class:te(["form-control",{"is-invalid":s.name}]),rules:"required"},null,8,["modelValue","class"]),u(K,{name:"name",class:"invalid-feedback"})]),e("div",dt,[it,u(z,{id:"enName",modelValue:p.value.keyword,"onUpdate:modelValue":t[2]||(t[2]=L=>p.value.keyword=L),name:"keyword",label:"\u82F1\u6587\u540D\u7A31",type:"text",class:te(["form-control",{"is-invalid":s.keyword}]),rules:{required:!0,regex:/^[0-9a-z_-]{1,50}$/},disabled:""},null,8,["modelValue","class"]),u(K,{name:"keyword",class:"invalid-feedback"})]),e("div",ct,[J(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=L=>p.value.enable=L),id:"flexCheckChecked"},null,512),[[De,p.value.enable]]),ut])]),e("div",pt,[e("button",{type:"button",disabled:!Q.valid,class:"btn btn-primary",onClick:t[4]||(t[4]=L=>ge(p.value.id))}," \u66F4\u65B0 ",8,mt)])])]),_:1},512)]),e("div",bt,[e("div",vt,[e("div",ht,[_t,e("ul",gt,[e("li",ft,[e("button",{class:"nav-link",onClick:t[5]||(t[5]=s=>W(n.value)),id:"pills-home-tab","data-bs-toggle":"pill","data-bs-target":"#pills-home",type:"button",role:"tab","aria-controls":"pills-home","aria-selected":"true"}," \u4EFB\u52D9\u7FA4\u7D44 ")]),e("li",yt,[e("button",{class:"nav-link",onClick:t[6]||(t[6]=s=>he(n.value)),id:"pills-profile-tab","data-bs-toggle":"pill","data-bs-target":"#pills-profile",type:"button",role:"tab","aria-controls":"pills-profile","aria-selected":"false"}," \u4EFB\u52D9 ")]),e("li",kt,[e("button",{class:"nav-link",id:"pills-contact-tab",onClick:t[7]||(t[7]=s=>_e(n.value)),"data-bs-toggle":"pill","data-bs-target":"#pills-contact",type:"button",role:"tab","aria-controls":"pills-contact","aria-selected":"false"}," \u76F4\u64AD\u73ED ")])])]),e("div",wt,[e("div",xt,[e("div",Mt,[(r(!0),i(E,null,j($.value,s=>(r(),i("ul",{class:"list-unstyled",key:s.id},[e("li",Ut,m(s.name),1)]))),128))]),e("div",$t,[(r(!0),i(E,null,j(se.value,s=>(r(),i("ul",{class:"list-unstyled",key:s.id},[e("li",null,m(s.name),1)]))),128))]),e("div",Ct,[(r(!0),i(E,null,j(ae.value,s=>(r(),i("ul",{class:"list-unstyled",key:s.id},[e("li",null,m(s.name),1)]))),128))])])])])])]),e("div",Tt,[e("div",Vt,[e("h2",Gt,[B(" \u5B78\u751F\u540D\u55AE\uFF08"+m(p.value.enrollments)+"\uFF09 ",1),e("button",{type:"button",class:"border-0 bg-white",ref_key:"tooltipRef",ref:V,"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"0"},Dt,512)]),e("div",Lt,[e("button",{type:"button",class:"btn btn-primary btn-sm me-3",onClick:t[8]||(t[8]=s=>Me(n.value))},[B(" \u624B\u52D5\u89F8\u767C Teachable \u540C\u6B65\u6392\u7A0B "),u(k(Le),{active:A.value,"is-full-page":!1,width:30,height:30},null,8,["active"])]),e("form",Bt,[e("div",St,[Rt,J(e("select",{id:"filter",class:"form-select form-select-sm","onUpdate:modelValue":t[9]||(t[9]=s=>X.value=s)},jt,512),[[Ge,X.value]])]),e("div",Ot,[e("div",Nt,[Pt,J(e("input",{id:"datatableSearch",type:"search",class:"form-control border-top-0 border-start-0 border-end-0 rounded-0","onUpdate:modelValue":t[10]||(t[10]=s=>P.value=s),placeholder:"\u641C\u5C0B\u540D\u7A31\u3001\u4FE1\u7BB1",onKeydown:t[11]||(t[11]=Ie(ie(s=>D({groupId:n.value,value:P.value,filter:X.value}),["prevent"]),["enter"]))},null,544),[[ve,P.value]])])])])])]),e("div",qt,[e("div",zt,[e("div",Kt,[e("table",Qt,[Ht,e("tbody",Jt,[(r(!0),i(E,null,j(ne.value,s=>(r(),i("tr",{class:"align-middle",key:s.id},[e("td",Wt,m(s.nickname),1),e("td",null,m(s.email),1),e("td",Xt,[u(a,{to:`/admin/users/${s.id}`,class:"text-link me-1",target:"_blank"},{default:w(()=>[B("\u67E5\u770B")]),_:2},1032,["to"]),e("a",{href:"#",class:"text-link text-danger",onClick:ie(Q=>we({userId:s.id,type:"deleteUserGroupIdUser",name:s.nickname}),["prevent"])},"\u522A\u9664",8,Yt)])]))),128))])])]),e("div",Zt,[u(k(Be),{modelValue:q.value.current_page,"onUpdate:modelValue":t[12]||(t[12]=s=>q.value.current_page=s),records:q.value.total,"per-page":100,options:{chunk:6},onPaginate:t[13]||(t[13]=s=>D({groupId:n.value,page:s}))},null,8,["modelValue","records"])]),U.value?H("",!0):(r(),i("div",es,[M.value?H("",!0):(r(),i("button",{key:0,type:"button",class:"btn btn-outline-dark bg-white text-dark",onClick:t[14]||(t[14]=s=>D({groupId:n.value,value:P.value}))},[B(" \u8B80\u53D6\u5B78\u54E1\u540D\u55AE "),M.value?(r(),i("div",ts,as)):H("",!0)]))]))])])])]),u(Ne,{ref_key:"createUsersModalComponentRef",ref:le,"temp-users":oe.value,onCreateUsersMethod:ke},null,8,["temp-users"]),u(Ke,{ref_key:"dangerActionsModalRef",ref:Y,body:re.value,onDangerUserMethod:xe},null,8,["body"])])}}};export{ns as default};
